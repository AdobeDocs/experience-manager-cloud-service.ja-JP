---
title: この記事では、コアコンポーネントに基づくアダプティブフォームのルールエディターの様々な使用例について説明します。
description: この記事では、コアコンポーネントに基づくアダプティブフォームのルールエディターの様々な使用例について説明します。 また、カスタム関数を使用して、フォーム用にカスタマイズされたルールを作成する方法についても重点的に説明します。
feature: Adaptive Forms, Core Components
role: User, Developer
level: Beginner, Intermediate
exl-id: 062ed441-6e1f-4279-9542-7c0fedc9b200
source-git-commit: fd3c53cf5a6d1c097a5ea114a831ff626ae7ad7e
workflow-type: tm+mt
source-wordcount: '1975'
ht-degree: 0%

---

# ルールエディターの機能強化とユースケース

<span class="preview"> これらは、<a href="https://experienceleague.adobe.com/docs/experience-manager-cloud-service/content/release-notes/prerelease.html?lang=ja#new-features"> プレリリースチャネル </a> を通じて使用できるプレリリース機能です。 これらの機能強化は、Edge Delivery Services Formsにも適用されます。

この記事では、アダプティブFormsのルールエディターの最新の機能強化について説明します。 これらの更新は、カスタムコードを記述することなく、より簡単にフォームの動作を定義し、より動的で、レスポンシブで、パーソナライズされたフォームエクスペリエンスを作成できるように設計されています。

次の表に、アダプティブFormsのルールエディターの最近の機能強化と、各機能の簡単な説明および主な利点を示します。

| 機能強化 | 説明 | メリット |
|---|----|---|
| **`validate()` メソッドを使用した検証** | 関数リストで使用でき、個々のフィールド、パネルまたはフォーム全体を検証できます。 | - パネル、フィールド、またはフォームレベルの <br> で詳細な検証を行う – ターゲットを絞り込んだエラーメッセージ <br> ールでユーザーエクスペリエンスを向上する – 不完全なデータ <br> ースで進行を防ぐ – フォーム送信エラーを減らす |
| **DOR をダウンロード** | レコードのドキュメント（DoR）をダウンロードするためにルールエディターで使用できる、すぐに使用できる関数。 | - DoR <br> のダウンロードにカスタム開発は必要ありません – フォーム間で一貫したダウンロードエクスペリエンス |
| **動的変数** | ユーザー入力またはその他の条件に基づいて変化する変数を使用して、ルールを作成します。 |  – 柔軟なルール条件を有効にする <br> – 重複ロジックの必要性を減らす <br> – 非表示フィールドを作成する必要がなくなります。 |
| **カスタムイベントベースのルール** | 標準のトリガーを超えるカスタムイベントに応答するルールを定義します。 |  – 高度なユースケースのサポート <br> - ルールを実行するタイミングと方法をより詳細に制御 <br>、インタラクティビティを強化 |
| **コンテキスト対応の繰り返し可能なパネル実行** | ルールは、最後のインスタンスだけでなく、繰り返される各パネルに対して正しいコンテキストで実行されるようになりました。 |  – 各リピートインスタンスの正確なルールアプリケーション <br> – 動的セクションのエラーを減らす <br> – 繰り返しコンテンツのユーザーエクスペリエンスを向上させます |
| **クエリ文字列、UTM およびブラウザーパラメーターのサポート** | URL パラメーターやブラウザー固有の値に基づいてフォームの動作を調整するルールを作成します。 | - ソースまたは環境 <br> に基づいてパーソナライゼーションを有効にする – マーケティングまたはトラッキング固有のフローに役立ちます <br> – 追加のスクリプトやカスタマイズは必要ありません |

>[!NOTE]
>
> この機能強化は、[Edge Delivery Services Formsのルールエディター ](/help/edge/docs/forms/universal-editor/rule-editor-universal-editor.md) にも適用できます。

次に、これらの機能を使用して、パーソナライズされたエクスペリエンスをユーザーに提供する方法を理解するのに役立つ具体的なユースケースについて、各方法を詳しく説明します

## 関数リスト内の Validate メソッド

検証機能の強化。関数リストで **validate （）** メソッドを使用すると、パネル、フィールド、フォーム全体を検証できます。 例えば、複数の手順から成るローン申し込みフォームでは、ユーザーが次の手順に進める前に、様々なセクションを検証する必要があります。

**シナリオ：** 金融機関は、ユーザーが次のような様々なセクションに記入する必要がある、複数の手順のローン申し込みフォームを提供します。

* 個人の詳細情報
* 雇用の詳細
* 融資詳細
* 確認して送信

ユーザーが 1 つの手順から次の手順に移動する前に、フォームは現在のセクション内のフィールドのみを検証する必要があります。 例えば、「個人情報」のすべての必須フィールドが正しく入力されていない限り、ユーザーは「雇用情報」に進むことを許可されません。

**ルールエディターで validate （）を使用した実装**

各パネルの「**次へ**」ボタンは、**validate （）** メソッドを使用してルールをトリガーします。 このルールは、現在のパネル内のすべてのフィールドが有効かどうかを確認します。 検証に成功した場合、フォームは次のパネルに移動します。 入力されていない場合は、エラーメッセージが表示され、ユーザーが入力を修正するように指示されます。

以下のスクリーンショットは、「**次へ**」ボタンに適用されるルールを示しています。

![ 「次へ検証」ボタン ](/help/forms/assets/validate-next.png)

上記のルールでは、「**次へ**」ボタンは「**個人の詳細** セクションのフィールドが有効かどうかを確認します。 詳細が無効な場合、フォーカスは **個人の詳細** パネルの **名前** フィールドに移動します。

![ 出力 ](/help/forms/assets/valid-output.png)

>[!NOTE]
>
>フォーム、フラグメントまたは個々のフィールドで **validate （）** メソッドを使用できます。 フラグメントがフォームに含まれると、検証コンテキストでは、フォームとフラグメントの両方がオプションとして表示されます。 この場合、フラグメントはその中のフィールドを参照し、フォームはフラグメントが埋め込まれている親フォームを参照します。

## ルールエディター内の OOTB 関数としての DownloadDor

ルールエディターに標準搭載の（OOTB） **DownloadDor （）** 関数を使用すると、レコードのドキュメントをダウンロードできます（フォームがレコードのドキュメントを生成するように設定されている場合）。

>[!NOTE]
>
>フォームがレコードのドキュメント用に設定されていない場合、**downloadDoR （）** 関数を使用したルールがボタンに適用されると、エラーメッセージが表示されます。

**シナリオ**：政府機関が証明書発行用のデジタル申請フォームを提供する。 フォームを送信した後、申請者は多くの場合、記録または他の部門と共有するために完成したフォームのコピーを必要とします。 ユーザーエクスペリエンスを向上させるために、アドビでは、申請者に対し、送信直後または最終的な送信前の任意の段階でレコードのドキュメント（DoR）をダウンロードするオプションを提供したいと考えています。

**ルールエディターで DownloadDor （）を使用した実装**

ルールエディターを使用してフォームに「**ダウンロード**」ボタンが追加され、ボタンがクリックされたときに **DownloadDor （）** 関数をトリガーするルールが設定されます。

以下のスクリーンショットは、「**ダウンロード**」ボタンに適用されるルールを示しています。

![ ダウンロードボタンルール ](/help/forms/assets/download-button-rule.png)

>[!NOTE]
>
> **入力** フィールドを使用すると、ユーザーはダウンロード可能なドキュメントのファイル名を指定できます。 これはオプションのパラメーターです。

フォームが DoR generation 用に設定されている場合、この関数は、カスタム関数を必要とせずに、PDFを即座に生成してダウンロードします。

![レコードのドキュメント](/help/forms/assets/download-dor-output.png)

## ルール内の動的変数のサポート

強化されたルールエディターでは、動的（一時）変数の作成と使用がサポートされています。 これらの変数は、組み込みの **変数値を設定** 関数および **変数値を取得** 関数を使用して、フォームのライフサイクル全体を通じて設定および取得できます。
これらの変数は、

* フォームデータと共に送信されない。
* 中間値または計算値を保持できます。
* 条件付きロジックおよびアクションで使用できます。

**シナリオ**：オンラインショッピングフォームを使用すると、ユーザーは製品の選択、数量の入力、配送先の国の選択を行うことができます。 製品価格はフォームフィールドを通じて取得される固定値であり、送料は選択した国に応じて動的に異なります。

非表示のフィールドを含むフォームが乱雑になることを避けるために、ビジネスでは、送料を一時変数に格納し、リアルタイム計算に使用することにしました。

**ルールエディターでの「変数値を設定」関数と「変数値を取得」関数を使用した実装**

>[!VIDEO](https://video.tv.adobe.com/v/3471607/get-set-variable-final-video/?quality=12&learn=on)

**Set Variable Value** 関数を使用して **Address** フラグメントにルールが設定され、**extracharge** という名前の一時変数が割り当てられます。 この変数の値は、選択した国に基づいて動的に変化します。 例：

* ユーザーが米国を選択した場合、**extracharge** は 500 に設定されます。
* その他の国では、**extracharge** が 100 に設定されます。

![ 変数値を設定 ](/help/forms/assets/setvalue.png)

その後、**Total Shipment Cost** が計算されると、**Get Variable Value** 関数を使用して **extracharge** の値が取得されます。 この値が **製品価格×製品数量** に追加され、ボタンのクリック時に最終支払金額が計算されます。

![ 変数値を取得 ](/help/forms/assets/getvalue.png)

ユーザーが国または数量を変更すると、「**合計出荷原価**」フィールドが動的に更新され、製品原価と出荷手数料の両方が反映されます。
![ 出力 ](/help/forms/assets/getsetvalue-output.png)

>[!NOTE]
>
> 「When」条件に「**変数値を取得**」関数を追加することもできます。
> &#x200B;> ![When 条件 ](/help/forms/assets/when-get-variable.png){width=50%,height=50%, align=center} の変数値を取得

このアプローチにより、フォームにフィールドを追加することなく動的でリアルタイムの計算が可能になり、構造がクリーンで使いやすくなります。

## カスタムイベントベースのルールのサポート

拡張ルールエディターでは、**ディスパッチイベント** および **オンイベントイベント** 関数を使用したカスタムトリガー処理をサポートしています。 これらの関数を使用すると、カスタムイベントを発生したりリッスンしたりしてフォームの様々な部分を通信し、特定のフィールドに対するアクションを緊密に結合することなく、よりクリーンなモジュール型ロジックを実現できます。

**シナリオ**:「ユーザー名を入力」フィールドと「パスワードを入力 **フィールドを含んだ再利用可能なログインフラグメントを使用してログインフォームを作成し** す **&#x200B;**。 ユーザーが有効な資格情報を指定すると、フォームは入力を検証し、**OTP を取得** プロセスを開始します。 ユーザーが有効な OTP を入力すると、適切なページにリダイレクトされます。

ロジックをフィールドに直接バインドする代わりに、フォームでは、**ディスパッチイベント** および **オンイベントイベント** のトリガーベースのアプローチを使用して、モジュール性と保守性を向上させます。

**派遣事象及びトリガー時事象を利用した実施**


>[!VIDEO](https://video.tv.adobe.com/v/3471610/dispatch-trigger-final/?quality=12&learn=on)

ログインフラグメントがフォームに追加され、ユーザー名およびパスワードの定義済みフィールドが含まれます。 ルールは、「**OTP を取得**」ボタンで設定され、OTP の入力および検証用の入力フィールドを含む **検証パネル** を表示します。

![OTP ルールを取得 ](/help/forms/assets/get-otp-rule.png)

**検証パネル** では、「検証」ボタンにルールが設定されています。 API 統合は、「**OTP を入力**」フィールドに入力された OTP を検証するために使用されます。 検証に成功した場合、API 応答を含んだイベントペイロードで **LoggedIn** という名前の **ディスパッチイベント** がトリガーされます。

![トリガー内イベントルール ](/help/forms/assets/trigger-event-rule.png)

フォームレベルで、**LoggedIn** イベントをリッスンするようにルールが設定されます。 このイベントがトリガーされると、ルールによってリダイレクトメッセージが表示され、ユーザーがダッシュボードページに移動します。

![ イベント ルールのディスパッチ ](/help/forms/assets/dispatch-event-rule.png)

ユーザーが正しい資格情報と有効な OTP を使用してフォームを送信すると、ログインに成功し、ユーザーはダッシュボードにリダイレクトされます。

カスタムイベントのサポート。開発者は、ルールエディターで条件として使用できるカスタムイベントを作成およびトリガーできます。

## 繰り返し可能なパネルに対するコンテキストベースのルールの実行

アダプティブFormsでは、繰り返し可能なパネルに対して、コンテキスト対応のルールの実行をサポートしています。 これにより、すべてのインスタンスに影響を与えたり、最後のインスタンスにデフォルト設定したりせずに、ユーザーがやり取りするパネルインスタンスにルールを適用できます。

**シナリオ**：製品注文フォームを使用すると、ユーザーは複数の製品を別々のパネルに追加できます。 各パネルには、「**製品数** フィールドと **合計コスト** フィールドが含まれます。 ユーザーが製品の数量を更新すると、フォームは合計価格を再計算する必要がありますが、その値は特定のパネルに限られ、その他のすべてのパネルには再計算されません。

**ルールエディターでコンテキスト対応ルールを使用する実装**

ルールは、繰り返し可能な製品パネル内の **製品数** フィールドに設定されます。

次のスクリーンショットは、繰り返し可能な製品パネル内の **製品数** フィールドのルールを示しています。

![ 製品ルールの数 ](/help/forms/assets/number-of-product-rule.png)

数量が変更されると、ルールは選択された製品の単価を取得し、そのパネルの合計原価のみを計算します。

![ コンテキスト対応ルールの出力 ](/help/forms/assets/context-aware-rule-output.png)

## アダプティブFormsの URL およびブラウザーパラメーターベースのルール

アダプティブFormsは、フォーム URL を通じて渡される、またはユーザーのブラウザー環境から派生する外部パラメーターを使用した、動的なルールの実行をサポートしています。 これにより、訪問者の出身場所や使用しているデバイスに基づいて、パーソナライズされたコンテキスト対応のフォームエクスペリエンスが可能になります。

## 許可されるパラメータータイプ

| パラメータータイプ | サポートされるオプション | 説明 | 値の例 |
| --- | --- | --- | ---|
| クエリパラメーター | `ref` （文字列値のみ） | `?` 後の URL の一般的なキーと値のペア | `?ref=partner123` |
| UTM パラメーター | UTM Source<br>UTM Medium<br>UTM キャンペーン <br>UTM 用語 <br>UTM コンテンツ | キャンペーントラッキングに使用される特別なクエリパラメーター | `?utm_source=google&utm_medium=email` |
| URL パラメーター | ホスト名 <br> パス | フォーム URL の構造コンポーネントを抽出します | `hostname=www.example.com`、`path=/signup` |
| ブラウザーパラメーター | ブラウザーエージェント <br> ブラウザー言語 <br> ブラウザープラットフォーム | ユーザーのブラウザーまたはデバイスから得られる値 | `Browser Agent=Mozilla`、`Language=en-US` |

**シナリオ**：リードジェネレーションフォームは、トラフィックソースに応じてウェルカムメッセージをカスタマイズする必要があります。 ユーザーがGoogle広告キャンペーン（URL で utm_source=google を使用）を通じてフォームにアクセスすると、フォームにカスタムの挨拶が表示されます。

**UTM パラメーターを使用した実装**

ルールは、Google ユーザーにカスタムメッセージを表示するテキストフィールドに設定され、**utm_source** パラメーターを使用します。

次のスクリーンショットは、テキストメッセージで設定されたルールを示しています。

![ テキストメッセージに関するルール ](/help/forms/assets/utm-param-rule.png)

**utm_source** パラメーター値が「google」に等しい場合、カスタムメッセージに「Googleユーザー様、キャンペーン広告へようこそ！」と表示されます。 が表示されます。

![utm-param-output](/help/forms/assets/utm-param-output.png)

これにより、マーケターは、手動のフィールド入力やカスタムスクリプティングを必要とせずに、ユーザーをフォームに導いたキャンペーンに基づいて、関連するコンテンツをユーザーに配信できます。

これらの機能強化により、アダプティブ Formsのルールエディターの機能が大幅に強化され、開発者はより動的でインタラクティブなインテリジェントなフォームを作成するための強力なツールを使用できるようになりました。 各機能強化は、技術的ユーザーと非技術的ユーザーの両方がルールエディターにアクセスできるようにする使いやすさを維持しながら、特定のビジネスニーズに対応します。

## その他のリソース

{{see-also-rule-editor}}
