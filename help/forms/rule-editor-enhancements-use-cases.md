---
title: この記事では、コアコンポーネントに基づくアダプティブフォームのルールエディターの様々な使用例について説明します。
description: この記事では、コアコンポーネントに基づくアダプティブフォームのルールエディターの様々な使用例について説明します。 また、カスタム関数を使用して、フォーム用にカスタマイズされたルールを作成する方法についても重点的に説明します。
feature: Adaptive Forms, Core Components
role: User, Developer
level: Beginner, Intermediate
source-git-commit: 4ff533de73fcb91fb2b68cfdb3fd2602645ff7aa
workflow-type: tm+mt
source-wordcount: '1863'
ht-degree: 0%

---

# ルールエディターの機能強化とユースケース

<span class="preview"> これらは、<a href="https://experienceleague.adobe.com/docs/experience-manager-cloud-service/content/release-notes/prerelease.html?lang=ja#new-features"> プレリリースチャネル </a> を通じて使用できるプレリリース機能です。

この記事では、アダプティブFormsのルールエディターの最新の機能強化について説明します。 これらの更新は、カスタムコードを記述することなく、より簡単にフォームの動作を定義し、より動的で、レスポンシブで、パーソナライズされたフォームエクスペリエンスを作成できるように設計されています。

次の表に、アダプティブFormsのルールエディターの最近の機能強化と、各機能の簡単な説明および主な利点を示します。：

| 機能強化 | 説明 | メリット |
|---|----|---|
| **`validate()` メソッドを使用した検証** | 関数リストで使用でき、個々のフィールド、パネルまたはフォーム全体を検証できます。 | - パネル、フィールド、またはフォームレベルの <br> で詳細な検証を行う – ターゲットを絞り込んだエラーメッセージ <br> ールでユーザーエクスペリエンスを向上する – 不完全なデータ <br> ースで進行を防ぐ – フォーム送信エラーを減らす |
| **DOR をダウンロード** | レコードのドキュメント（DoR）をダウンロードするためにルールエディターで使用できる、すぐに使用できる関数。 | - DoR <br> のダウンロードにカスタム開発は必要ありません – フォーム間で一貫したダウンロードエクスペリエンス |
| **動的変数** | ユーザー入力またはその他の条件に基づいて変化する変数を使用して、ルールを作成します。 |  – 柔軟なルール条件を有効にする <br> – 重複ロジックの必要性を減らす <br> – 非表示フィールドを作成する必要がなくなります。 |
| **カスタムイベントベースのルール** | 標準のトリガーを超えるカスタムイベントに応答するルールを定義します。 |  – 高度なユースケースのサポート <br> - ルールを実行するタイミングと方法をより詳細に制御 <br>、インタラクティビティを強化 |
| **コンテキスト対応の繰り返し可能なパネル実行** | ルールは、最後のインスタンスだけでなく、繰り返される各パネルに対して正しいコンテキストで実行されるようになりました。 |  – 各リピートインスタンスの正確なルールアプリケーション <br> – 動的セクションのエラーを減らす <br> – 繰り返しコンテンツのユーザーエクスペリエンスを向上させます |
| **クエリ文字列、UTM およびブラウザーパラメーターのサポート** | URL パラメーターやブラウザー固有の値に基づいてフォームの動作を調整するルールを作成します。 | - ソースまたは環境 <br> に基づいてパーソナライゼーションを有効にする – マーケティングまたはトラッキング固有のフローに役立ちます <br> – 追加のスクリプトやカスタマイズは必要ありません |

次に、これらの機能を使用して、パーソナライズされたエクスペリエンスをユーザーに提供する方法を理解するのに役立つ具体的なユースケースについて、各方法を詳しく説明します

## 関数リスト内の Validate メソッド

検証機能の強化。関数リストで **validate （）** メソッドを使用すると、パネル、フィールド、フォーム全体を検証できます。 例えば、複数の手順から成るローン申し込みフォームでは、ユーザーが次の手順に進める前に、様々なセクションを検証する必要があります。

**シナリオ：** 金融機関は、ユーザーが次のような様々なセクションに記入する必要がある、複数の手順のローン申し込みフォームを提供します。

* 個人の詳細情報
* 雇用の詳細
* 融資詳細
* 確認して送信

ユーザーが 1 つの手順から次の手順に移動する前に、フォームは現在のセクション内のフィールドのみを検証する必要があります。 例えば、「個人情報」のすべての必須フィールドが正しく入力されていない限り、ユーザーは「雇用情報」に進むことを許可されません。

**ルールエディターで validate （）を使用した実装**

各パネルの「**次へ**」ボタンは、**validate （）** メソッドを使用してルールをトリガーします。 このルールは、現在のパネル内のすべてのフィールドが有効かどうかを確認します。 検証に成功した場合、フォームは次のパネルに移動します。 入力されていない場合は、エラーメッセージが表示され、ユーザーが入力を修正するように指示されます。

以下のスクリーンショットは、「**次へ**」ボタンに適用されるルールを示しています。

![ 「次へ検証」ボタン ](/help/forms/assets/validate-next.png)

上記のルールでは、「**次へ**」ボタンは「**個人の詳細** セクションのフィールドが有効かどうかを確認します。 詳細が無効な場合、フォーカスは **個人の詳細** パネルの **名前** フィールドに移動します。

![ 出力 ](/help/forms/assets/valid-output.png)

>[!NOTE]
>
> フォーム、フラグメントまたは個々のフィールドで **validate （）** メソッドを使用できます。 フラグメントがフォームに含まれると、検証コンテキストでは、フォームとフラグメントの両方がオプションとして表示されます。 この場合、フラグメントはその中のフィールドを参照し、フォームはフラグメントが埋め込まれている親フォームを参照します。

## ルールエディター内の OOTB 関数としての DownloadDor

ルールエディターに標準搭載の（OOTB） **DownloadDor （）** 関数を使用すると、レコードのドキュメントをダウンロードできます（フォームがレコードのドキュメントを生成するように設定されている場合）。

>[!NOTE]
>
> フォームがレコードのドキュメント用に設定されていない場合、**downloadDoR （）** 関数を使用したルールがボタンに適用されると、エラーメッセージが表示されます。

**シナリオ**：政府機関が証明書発行用のデジタル申請フォームを提供する。 フォームを送信した後、申請者は多くの場合、記録または他の部門と共有するために完成したフォームのコピーを必要とします。 ユーザーエクスペリエンスを向上させるために、アドビでは、申請者に対し、送信直後または最終的な送信前の任意の段階でレコードのドキュメント（DoR）をダウンロードするオプションを提供したいと考えています。

**ルールエディターで DownloadDor （）を使用した実装**

ルールエディターを使用してフォームに「**ダウンロード**」ボタンが追加され、ボタンがクリックされたときに **DownloadDor （）** 関数をトリガーするルールが設定されます。

以下のスクリーンショットは、「**ダウンロード**」ボタンに適用されるルールを示しています。

![ ダウンロードボタンルール ](/help/forms/assets/download-button-rule.png)

>[!NOTE]
>
> **入力** フィールドを使用すると、ユーザーはダウンロード可能なドキュメントのファイル名を指定できます。 これはオプションのパラメーターです。

フォームが DoR generation 用に設定されている場合、この関数は、カスタム関数を必要とせずに、PDFを即座に生成してダウンロードします。

![レコードのドキュメント](/help/forms/assets/download-dor-output.png)

## ルール内の動的変数のサポート

拡張ルールエディターで、動的（一時）変数の作成と使用がサポートされるようになりました。 これらの変数は、組み込みの **変数値を設定** 関数および **変数値を取得** 関数を使用して、フォームのライフサイクル全体を通じて設定および取得できます。
これらの変数は、

* フォームデータと共に送信されない。
* 中間値または計算値を保持できます。
* 条件付きロジックおよびアクションで使用できます。

**シナリオ**：ある e コマース会社が提供する注文フォームで、ユーザーが製品と希望する発送方法を選択できます。 製品価格はフォームフィールドを通じて取得されますが、送料は、選択した方法と選択した国に基づいて動的に決定されます。

フォーム構造をクリーンに保ち、不要な非表示フィールドを追加しないようにするために、企業では、合計金額のリアルタイム計算をサポートする一時的な値として出荷コストを処理したいと考えています。

**ルールエディターでの「変数値を設定」関数と「変数値を取得」関数を使用した実装**

ルールは、**Set Variable Value** 関数を使用して **extracharge** という名前の一時変数を設定するように設定されます。 この変数の値は、選択した国によって異なります。 例えば、ユーザーが「米国」を選択した場合、値は 50 に設定されます。 その他の国の場合は、100 に設定されます。

![ 変数値を設定 ](/help/forms/assets/setvalue.png)

その後、合計出荷コストを計算する際に、**変数値の取得** 関数は、選択した国に基づいて **extracharge** 値を取得します。

![ 変数値を取得 ](/help/forms/assets/getvalue.png)

この値が製品の送料に追加され、その結果が **合計送料** フィールドに表示されます。

![ 出力 ](/help/forms/assets/getsetvalue-output.png)

このアプローチにより、追加料金を目に見えるフィールドに保存することなく動的に計算および表示でき、クリーンでレスポンシブな、コードのないユーザーエクスペリエンスを実現できます。


## カスタムイベントベースのルールのサポート

拡張ルールエディターでは、**ディスパッチイベント** および **オンイベントイベント** 関数を使用したカスタムトリガー処理をサポートしています。 これらの関数を使用すると、カスタムイベントを発生したりリッスンしたりしてフォームの様々な部分を通信し、特定のフィールドに対するアクションを緊密に結合することなく、よりクリーンなモジュール型ロジックを実現できます。

**シナリオ**：ジョブ申請フォームが、バックグラウンド検証を実行する外部の人事システムと統合されています。 チェックが完了すると、システムにより「バックグラウンド検証が完了しました **という名前でフォームが更新されます。** メッセージ。 フォームは、この結果に基づいて申込者に表示される内容を動的に調整する必要があります。

ステータスを受け取るフィールドにロジックを直接バインドする代わりに、フォームでは、カスタムイベントベースのアプローチを使用して、モジュール性と保守性を向上させます。

**派遣事象及びトリガー時事象を利用した実施**

バックグラウンドチェックのステータスが更新されると、ルールが **ディスパッチイベント** を使用して、ステータスの結果と共にカスタムイベントを **bgvmsg** として生成します。 別のルールは、**トリガーイベント時** を使用してこのイベントをリッスンします。

以下のスクリーンショットは、「バックグラウンド検証は完了していますか？」に適用されるルールを示しています。 ラジオボタンと「bgvmsg」テキストフィールド。

![ イベントのディスパッチ ](/help/forms/assets/dispatch-event-rule.png)

![トリガー時イベント ](/help/forms/assets/trigger-event-rule.png)

イベントが検出されると、ステータスをチェックし、それに応じてフォームを更新します。 例：

* バックグラウンドチェックに合格すると、フォームに確認メッセージが表示されます。
* 追加のドキュメントが必要な場合、フォームには、申請者に必要な情報をアップロードすることを求めるセクションとアラートメッセージが表示されます。

![ イベント出力のディスパッチ ](/help/forms/assets/dispatch-trigger-output.png)

カスタムイベントのサポート。開発者は、ルールエディターで条件として使用できるカスタムイベントを作成およびトリガーできます。

## 繰り返し可能なパネルに対するコンテキストベースのルールの実行

アダプティブFormsでは、繰り返し可能なパネルに対して、コンテキスト対応のルールの実行をサポートしています。 これにより、すべてのインスタンスに影響を与えたり、最後のインスタンスにデフォルト設定したりせずに、ユーザーがやり取りするパネルインスタンスにルールを適用できます。

**シナリオ**：製品注文フォームを使用すると、ユーザーは複数の製品を別々のパネルに追加できます。 各パネルには、「**製品数** フィールドと **合計コスト** フィールドが含まれます。 ユーザーが製品の数量を更新すると、フォームは合計価格を再計算する必要がありますが、その値は特定のパネルに限られ、その他のすべてのパネルには再計算されません。

**ルールエディターでコンテキスト対応ルールを使用する実装**

ルールは、繰り返し可能な製品パネル内の **製品数** フィールドに設定されます。

次のスクリーンショットは、繰り返し可能な製品パネル内の **製品数** フィールドのルールを示しています。

![ 製品ルールの数 ](/help/forms/assets/number-of-product-rule.png)

数量が変更されると、ルールは選択された製品の単価を取得し、そのパネルの合計原価のみを計算します。

![ コンテキスト対応ルールの出力 ](/help/forms/assets/context-aware-rule-output.png)

## アダプティブFormsの URL およびブラウザーパラメーターベースのルール

アダプティブFormsは、フォーム URL を通じて渡される、またはユーザーのブラウザー環境から派生する外部パラメーターを使用した、動的なルールの実行をサポートしています。 これにより、訪問者の出身場所や使用しているデバイスに基づいて、パーソナライズされたコンテキスト対応のフォームエクスペリエンスが可能になります。

## 許可されるパラメータータイプ

| パラメータータイプ | サポートされるオプション | 説明 | 値の例 |
| --- | --- | --- | ---|
| クエリパラメーター | `ref` （文字列値のみ） | `?` 後の URL の一般的なキーと値のペア | `?ref=partner123` |
| UTM パラメーター | UTM Source<br>UTM Medium<br>UTM キャンペーン <br>UTM 用語 <br>UTM コンテンツ | キャンペーントラッキングに使用される特別なクエリパラメーター | `?utm_source=google&utm_medium=email` |
| URL パラメーター | ホスト名 <br> パス | フォーム URL の構造コンポーネントを抽出します | `hostname=www.example.com`、`path=/signup` |
| ブラウザーパラメーター | ブラウザーエージェント <br> ブラウザー言語 <br> ブラウザープラットフォーム | ユーザーのブラウザーまたはデバイスから得られる値 | `Browser Agent=Mozilla`、`Language=en-US` |

**シナリオ**：リードジェネレーションフォームは、トラフィックソースに応じてウェルカムメッセージをカスタマイズする必要があります。 ユーザーがGoogle広告キャンペーン（URL で utm_source=google を使用）を通じてフォームにアクセスすると、フォームにカスタムの挨拶が表示されます。

**UTM パラメーターを使用した実装**

ルールは、Google ユーザーにカスタムメッセージを表示するテキストフィールドに設定され、**utm_source** パラメーターを使用します。

次のスクリーンショットは、テキストメッセージで設定されたルールを示しています。

![ テキストメッセージに関するルール ](/help/forms/assets/utm-param-rule.png)

**utm_source** パラメーター値が「google」に等しい場合、カスタムメッセージに「Googleユーザー様、キャンペーン広告へようこそ！」と表示されます。 が表示されます。

![utm-param-output](/help/forms/assets/utm-param-output.png)

これにより、マーケターは、手動のフィールド入力やカスタムスクリプティングを必要とせずに、ユーザーをフォームに導いたキャンペーンに基づいて、関連するコンテンツをユーザーに配信できます。

これらの機能強化により、アダプティブ Formsのルールエディターの機能が大幅に強化され、開発者はより動的でインタラクティブなインテリジェントなフォームを作成するための強力なツールを使用できるようになりました。 各機能強化は、技術的ユーザーと非技術的ユーザーの両方がルールエディターにアクセスできるようにする使いやすさを維持しながら、特定のビジネスニーズに対応します。