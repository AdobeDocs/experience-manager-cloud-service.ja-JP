---
title: AEM タグ付けフレームワーク
description: コンテンツへのタグ付けと AEM タグ付けインフラストラクチャの利用 分類して整理するために。
translation-type: tm+mt
source-git-commit: 4bf023068aa69fb6b69c6f2443703ea2bbbf7d42
workflow-type: tm+mt
source-wordcount: '1567'
ht-degree: 20%

---


# AEMタグフレームワーク{#aem-tagging-framework}

タグ付けにより、コンテンツを分類および整理できますタグの分類には、名前空間と分類を使用できます。タグの使用に関する詳細は、次のとおりです。

* コンテンツ作成者としてのタグ付けについて詳しくは、[タグ](/help/sites-cloud/authoring/features/tags.md)の使用を参照してください。
* タグの作成と管理、および適用されたコンテンツタグについては、管理者の観点から、「タグの管理」を参照してください。

この記事では、AEMでタグ付けをサポートする基本的なフレームワークと、それを開発者として活用する方法に焦点を当てます。

## 概要 {#introduction}

コンテンツにタグ付けし、AEM タグ付けインフラストラクチャを利用するには：

* タグは、[タクソノミルートノードの下に[`cq:Tag`](#cq-tag-node-type)型のノードとして存在する必要があります。](#taxonomy-root-node)
* タグ付きコンテンツノードの`NodeType`には[`cq:Taggable`](#taggable-content-cq-taggable-mixin)ミックスインが含まれている必要があります。
* [`TagID`](#tagid)はコンテンツノードの[`cq:tags`](#cq-tags-property)プロパティに追加され、[`cq:Tag`型のノードに解決されます。](#cq-tag-node-type)

## cq:Tag Node Type {#cq-tag-node-type}

タグの宣言は、リポジトリ内のタイプ`cq:Tag.`のノードで取得されます

* タグは単純な単語(例：`sky`)または階層的分類(例：`fruit/apple`。一般的な果物と、より具体的なリンゴの両方を意味します。
* タグは一意の`TagID`で識別されます。
* タグには、タイトル、ローカライズされたタイトル、説明など、任意のメタ情報があります。タイトルは、`TagID`ではなく、ユーザーインターフェイスに表示する必要があります（存在する場合）。

タグ付けフレームワークでは、作成者やサイト訪問者に、特定の事前定義されたタグだけを使用するよう制限を設けることもできます。

### タグの特徴 {#tag-characteristics}

* ノードタイプは`cq:Tag`です。
* ノード名は[`TagID`.](#tagid)のコンポーネントです。
* [`TagID`](#tagid)には常に[名前空間が含まれます。](#tag-namespace)
* `jcr:title`プロパティ（UIに表示するタイトル）はオプションです。
* `jcr:description`プロパティはオプションです。
* 子ノードを含む場合、は[コンテナタグと呼ばれます。](#container-tags)
* タグは、[分類ルートノードと呼ばれる基本パスの下のリポジトリに保存されます。](#taxonomy-root-node)

### タグ ID {#tagid}

`TagID`は、リポジトリ内のタグノードに解決されるパスを識別します。

通常、`TagID`は名前空間で始まる略記法`TagID`か、[分類ルートノードから始まる絶対`TagID`です。](#taxonomy-root-node)

コンテンツがタグ付けされるとき、まだ存在しない場合は、[`cq:tags`](#cq-tags-property)プロパティがコンテンツノードに追加され、`TagID`がプロパティの`String`配列値に追加されます。

`TagID`は、[名前空間](#tag-namespace)の後にローカル`TagID`が続く構成です。 [コンテナ](#container-tags) タグには、分類内の階層順を表すサブタグが含まれます。サブタグは、ローカルの`TagID`と同じタグを参照するために使用できます。 例えば、コンテンツがサブタグを含むコンテナタグ（`fruit/apple`や`fruit/banana`など）であっても、コンテンツに`fruit`でタグ付けすることができます。

### 分類のルートノード {#taxonomy-root-node}

分類のルートノードは、リポジトリ内にあるすべてのタグの基本パスです。分類ルートノードは、*タイプ`cq:Tag`のノードではなく*&#x200B;必要です。

AEMでは、基本パスは`/content/cq:tags`で、ルートノードのタイプは`cq:Folder`です。

### タグの名前空間 {#tag-namespace}

名前空間を使用するとグループ化をおこなうことができます。最も一般的な使用例は、サイトごとに名前空間（公共用、社内用など）または大規模なアプリケーションごとに名前空間を置くことですが（サイトやアセットなど）、他の様々なニーズに対してはアプリケーションを使用できます。 名前空間は、ユーザーインターフェイスで使用され、現在のコンテンツに適用されるタグのサブセット(特定の名前空間のタグなど)のみを表示します。

タグの名前空間は、分類サブツリーの最初のレベルです。これは、[分類のルートノードの直下のノードです。](#taxonomy-root-node) 名前空間とは、親がノードタイプで `cq:Tag` はないタイプの `cq:Tag` ノードです。

すべてのタグには名前空間があります。名前空間を指定しない場合、タグはデフォルトの名前空間(`TagID` `default`)に割り当てられます。`/content/cq:tags/default`。  この場合、タイトルはデフォルトで`Standard Tags`に設定されます。

### コンテナタグ {#container-tags}

コンテナタグは、任意の数およびタイプの子ノードを含む、`cq:Tag` タイプのノードです。これにより、カスタムメタデータを使用してタグモデルを強化できます。

さらに、分類内のコンテナタグ（スーパータグ）は、すべてのサブタグのサブ集計として機能します。例えば、`fruit/apple`でタグ付けされたコンテンツも`fruit`でタグ付けされたと見なされます。つまり、`fruit`でタグ付けされたコンテンツを検索する場合も、`fruit/apple`でタグ付けされたコンテンツが見つかります。

### タグ ID の解決 {#resolving-tagids}

タグIDにコロン(`:`)が含まれる場合は、コロンでタグまたは副分類から名前空間を区切り、通常のスラッシュ(`/`)で区切ります。 タグ ID にコロンが含まれていない場合は、デフォルトの名前空間が暗示されます。

タグの標準的で唯一の場所は`/content/cq:tags`より下です。

`cq:Tag`ノードを指していない、既存でないパスまたはパスを参照するタグは、無効と見なされ、無視されます。

次の表に、サンプル`TagID`とその要素、および`TagID`がリポジトリ内の絶対パスに解決される方法を示します。

| `TagID` | 名前空間 | ローカルID | コンテナタグ | リーフタグ | Repository Absolute Tag Path |
|---|---|---|---|---|---|
| `dam:fruit/apple/braeburn` | `dam` | `fruit/apple/braeburn` | `fruit`,`apple` | `braeburn` | `content/cq:tags/dam/fruit/apple/braeburn` |
| `color/red` | `default` | `color/red` | `color` | `red` | `/content/cq:tags/default/color/red` |
| `sky` | `default` | `sky` | (なし) | `sky` | `/content/cq:tags/default/sky` |
| `dam:` | `dam` | (なし) | (なし) | (なし) | `/content/cq:tags/dam` |
| `content/cq:tags/category/car` | `category` | `car` | `car` | `car` | `content/cq:tags/category/car` |

### タグタイトルのローカリゼーション {#localization-of-tag-title}

タグにオプションのタイトル文字列`jcr:title`が含まれる場合は、`jcr:title.<locale>`プロパティを追加して、表示するタイトルをローカライズできます。

詳しくは、以下を参照してください。

* [様々な言語のタグ。開発者](tagging-applications.md#tags-in-different-languages) としてのAPIの使用を説明しています。
* 様々な言語でのタグの管理（管理者としてのタグ付けコンソールの使用を説明）

### アクセス制御 {#access-control}

タグは、リポジトリ内で[分類のルートノードの下にノードとして存在します。](#taxonomy-root-node) 特定の名前空間で作成者やサイト訪問者がタグを作成することを許可または拒否するには、リポジトリで適切なACLを設定します。

特定のタグや名前空間に対する読み取り権限を拒否すると、特定のコンテンツにタグを適用する機能が制御されます。

一般的な方法には以下のものがあります。

* `tag-administrators`グループ/ロールに対するすべての名前空間への書き込みアクセスを許可する（`/content/cq:tags`の下に追加/変更を行う）。 このグループは、追加設定なしで使用できる AEM に付属しています。
* 読み取り可能なすべての名前空間（ほとんどすべて）へのアクセスをユーザー/作成者に許可します。
* ユーザー/作成者が、タグを自由に定義できる名前空間への書き込みアクセスを許可する（`/content/cq:tags/some_namespace`の下の`add_node`）

## タグ付け可能なコンテンツ：cq:Taggable Mixin {#taggable-content-cq-taggable-mixin}

アプリケーション開発者がコンテンツタイプにタグを付けるには、ノードの登録([CND](https://jackrabbit.apache.org/node-type-notation.html))に`cq:Taggable`ミックスインまたは`cq:OwnerTaggable`ミックスインを含める必要があります。

`cq:OwnerTaggable` mixin は `cq:Taggable` から継承されており、その目的は、所有者または作成者がコンテンツを分類できることを示すことです。AEMでは、`cq:PageContent`ノードの属性に過ぎません。 `cq:OwnerTaggable`ミックスインは、タグ付けフレームワークでは必要ありません。

>[!NOTE]
>
>集計されたコンテンツ項目（または`jcr:content`ノード）の最上位ノードでのみタグを有効にすることをお勧めします。 次のような例があります。
>
>* `jcr:content`ノードのタイプが`cq:PageContent`であるページ(`cq:Page`)。`cq:Taggable`ミックスインが含まれます。
>* アセット(`cq:Asset`)。`jcr:content/metadata`ノードには常に`cq:Taggable`ミックスインがあります。


### ノードタイプ表記(CND) {#node-type-notation-cnd}

ノードタイプの定義は、リポジトリ内に CND ファイルとして存在します。CND表記は、[JCRドキュメント](https://jackrabbit.apache.org/node-type-notation.html)の一部として定義されています。

AEM に含まれるノードタイプの基本的な定義は、次のようになります。

```xml
[cq:Tag] > mix:title, nt:base
    orderable
    - * (undefined) multiple
    - * (undefined)
    + * (nt:base) = cq:Tag version

[cq:Taggable]
    mixin
    - cq:tags (string) multiple

[cq:OwnerTaggable] > cq:Taggable
    mixin
```

## cq:tagsプロパティ{#cq-tags-property}

`cq:tags`プロパティは`String`配列です。作成者やサイト訪問者がコンテンツに適用する1つ以上の`TagID`を格納するのに使用します。 このプロパティは、[`cq:Taggable`](#taggable-content-cq-taggable-mixin)ミックスインで定義されたノードに追加された場合にのみ意味を持ちます。

>[!NOTE]
>
>AEMタグ機能を活用するために、カスタム開発アプリケーションは`cq:tags`以外のタグプロパティを定義しないでください。

## タグの移動と統合 {#moving-and-merging-tags}

以下に、タグ管理コンソールを使用してタグを移動または結合する際のリポジトリ内での効果を説明します。

タグAを`/content/cq:tags`の下のタグBに移動または結合する場合：

* タグAは削除されず、`cq:movedTo`プロパティを受け取ります。
   * `cq:movedTo` は、タグBを指します。
   * このプロパティは、タグAがタグBに移動または結合されたことを意味します。
   * タグBを移動すると、それに応じてこのプロパティが更新されます。
   * タグAは非表示になるので、リポジトリに保持されるのは、タグAを指すコンテンツノード内のタグIDを解決するためだけです。
   * タグガベージコレクターは、タグAのようなタグを、コンテンツノードがそれらを参照しない状態で削除します。
   * `cq:movedTo`プロパティの特別な値は`nirvana`です。これは、タグが削除されたときに適用されますが、保持する必要がある`cq:movedTo`を持つサブタグがあるので、リポジトリから削除することはできません。

      >[!NOTE]
      >
      >`cq:movedTo`プロパティは、次のいずれかの条件を満たす場合にのみ、移動されたタグまたは結合されたタグに追加されます。
      >
      > 1. タグはコンテンツで使用されます（参照が含まれていることを意味します）。 または
      > 1. タグには、既に移動された子が含まれています。


* タグBが（移動の場合に）作成され、`cq:backlinks`プロパティを受け取ります。
   * `cq:backlinks` は、参照を他の方向に保持します。つまり、タグBに移動または結合されたすべてのタグのリストを保持します。
   * これは、タグBが移動、結合、削除されたとき、またはタグBがアクティブになったときに、`cq:movedTo`プロパティを最新の状態に保つために最も必要になります。この場合、すべてのバックリンクタグもアクティブにする必要があります。

      >[!NOTE]
      >
      >`cq:backlinks`プロパティは、次のいずれかの条件を満たす場合にのみ、移動されたタグまたは結合されたタグに追加されます。
      >
      > 1. タグはコンテンツで使用されます（参照が含まれていることを意味します）。 または
      > 1. タグには、既に移動された子が含まれています。


コンテンツノードの`cq:tags`プロパティを読み取るには、次の解像度を使用します。

1. `/content/cq:tags`の下で一致が見つからない場合、タグは返されません。
1. タグに`cq:movedTo`プロパティが設定されている場合は、参照先のタグIDが使用されます。
   * これは、その次のタグに `cq:movedTo` プロパティがある限り繰り返されます。
1. 次のタグに `cq:movedTo` プロパティがない場合は、そのタグが読み取られます。

タグを移動または結合したときに変更を発行するには、`cq:Tag`ノードとそのすべてのバックリンクを複製する必要があります。 これは、タグ管理コンソールでタグがアクティブ化されたときに自動的に行われます。

後でページの`cq:tags`プロパティを更新すると、古い参照が自動的にクリーンアップされます。 移動したタグを API で解決すると移動先のタグが戻され、移動先のタグ ID が提供されることから、この処理がトリガーされます。
