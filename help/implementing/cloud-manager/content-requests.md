---
title: Cloud Service コンテンツリクエストについて
description: アドビからコンテンツリクエストライセンスを購入している場合は、Adobe Experience Cloud as a Service が測定するコンテンツリクエストのタイプと、組織の分析レポートツールとの相違について説明します。
exl-id: 3666328a-79a7-4dd7-b952-38bb60f0967d
solution: Experience Manager
feature: Cloud Manager, Developing
role: Admin, Architect, Developer
source-git-commit: 646ca4f4a441bf1565558002dcd6f96d3e228563
workflow-type: tm+mt
source-wordcount: '2688'
ht-degree: 100%

---

# Cloud Service コンテンツリクエスト

## はじめに {#introduction}

Cloud Service コンテンツリクエストは、サーバーサイドのデータ収集を通じて測定されます。コレクションは、CDN ログ分析を通じて有効になります。

>[!NOTE]
>また、一部の[早期導入お客様](/help/release-notes/release-notes-cloud/release-notes-current.md#sites-early-adopter)向けに、リアルユーザーモニタリングサービスの測定を介したクライアントサイドのコレクションも有効になります。詳しくは、[この記事](#real-user-monitoring-for-aem-as-a-cloud-service)のドキュメントを参照してください。

## Cloud Service コンテンツリクエストについて {#understaing-cloud-service-content-requests}

コンテンツリクエストは、AEM as a Cloud Service CDN からのログファイルの自動分析を通じて、Adobe Experience Manager as a Cloud Service のエッジのサーバーサイドで自動的に収集されます。これは、HTML `(text/html)` または JSON `(application /Json)` コンテンツを返すリクエストを CDN から分離し、以下で説明するいくつかの包含ルールと除外ルールに基づいて行われます。コンテンツリクエストは、CDN キャッシュから提供される、返されたコンテンツとは独立して行われるか、CDN（AEM Dispatchers）の元に戻されます。

クライアントサイドのコレクションであるリアルユーザーモニタリングサービスは、ユーザーインタラクションをより正確に反映し、web サイトのエンゲージメントの信頼できる測定を保証します。これにより、お客様はページのトラフィックとパフォーマンスに関する高度なインサイトを取得できます。これは、アドビが管理する CDN と アドビ以外が管理する CDN を使用する両方のお客様にとって有益です。さらに、アドビ以外が管理する CDN を使用しているお客様に対して自動トラフィックレポートを有効にできるので、トラフィックレポートをアドビと共有する必要がなくなります。

独自の CDN を AEM as a Cloud Service 上に導入しているお客様の場合、サーバーサイドのレポートでは、ライセンス済みのコンテンツリクエストとの比較に使用できない数値が生じます。この数値は、外部の CDN のエッジでお客様が測定する必要があります。このようなお客様にとって、クライアントサイドのレポートおよび関連するパフォーマンスを考慮すると、[Adobe RUM データサービス](#real-user-monitoring-for-aem-as-a-cloud-service)がアドビの推奨オプションです。オプトイン方法については、[リリースノート](/help/release-notes/release-notes-cloud/release-notes-current.md#sites-early-adopter)を参照してください。

## サーバーサイドのコレクション {#serverside-collection}

よく知られているボットを除外するルールが用意されています。これには、検索インデックスまたはサービスを更新するためにサイトに定期的にアクセスするよく知られているサービスも含まれます。

### Cloud Service コンテンツリクエストの相違 {#content-requests-variances}

コンテンツリクエストには、次の表にまとめられているように、組織の分析レポートツールとは違いがあります。一般に、クライアントサイドの計測機能を使用してデータを収集し、特定のサイトに対するコンテンツリクエストの数をレポートする分析ツールは使用&#x200B;*しないでください*。なぜなら、多くの場合、分析ツールはトリガーされる際にユーザーの同意に依存しているので、トラフィックの大部分が欠落しているからです。AEM as a Cloud Service の上に独自の CDN を追加するお客様向けに、ログファイルのサーバーサイドでデータを収集する Analytics ツール、または CDN レポートを使用すると、カウントが向上します。ページビューおよび関連するパフォーマンスのレポートでは、Adobe RUM データサービスがアドビ推奨のオプションです。

| 差異の理由 | 説明 |
|---|---|
| エンドユーザーの同意 | クライアント側の計測機能に依存する Analytics ツールは、多くの場合、ユーザーの同意がトリガーされるかどうかに依存します。これは、トラフィックの大部分がトラッキングされていないことを表している可能性があります。コンテンツリクエストを独自に測定する場合は、Analytics ツールに依存してサーバー側または CDN レポートのデータを収集することをお勧めします。 |
| タグ付け | Adobe Experience Manager（AEM）コンテンツリクエストとして追跡されるすべてのページまたは API 呼び出しに対して、Analytics トラッキングでタグ付けされない場合があります。 |
| タグ管理ルール | タグ管理ルールの設定により、ページ上で様々なデータ収集設定が行われ、その結果、コンテンツリクエストのトラッキングとは何らかの不一致が生じる場合があります。 |
| ボット | AEM によって事前に識別および削除されていない不明なボットは、トラッキング不一致の原因となる場合があります。 |
| レポートスイート | 同じ AEM インスタンスとドメインに属するページが、異なる Analytics レポートスイートにデータを送信する場合があります。 |
| サードパーティのモニタリングツールとセキュリティツール | モニタリングツールやセキュリティスキャンツールによっては、Analytics レポートでは追跡されない AEM のコンテンツリクエストが生成される場合があります。 |
| API アクセス | ページまたは Adobe Experience Manager API にプログラムでアクセスすると、Analytics レポートで追跡されない AEM のコンテンツリクエストが生成される場合があります。 |
| プリフェッチリクエスト | ページを事前にロードして速度を上げるプリフェッチサービスを使用すると、コンテンツリクエストのトラフィックが大幅に増加する可能性があります。 |
| DDoS | アドビでは、DDoS 攻撃からのトラフィックを自動的に検出して除外しようとしていますが、発生し得るすべての DDoS 攻撃が検出される保証はありません。 |
| トラフィックブロッカー | ブラウザーでトラッカーブロッカーを使用すると、一部のリクエストの追跡がオプトアウトされる可能性があります。 |
| ファイアウォール | ファイアウォールによって、Analytics のトラッキングがブロックされる可能性があります。このシナリオは、企業のファイアウォールで発生頻度が高くなります。 |

[ライセンスダッシュボード](/help/implementing/cloud-manager/license-dashboard.md)も参照してください。

### 含まれるコンテンツリクエストのタイプ {#included-content-requests}

| リクエストタイプ | コンテンツリクエスト | 説明 |
| --- | --- | --- |
| HTTP コード 100-299 | 次のものが含まれます。 | これらは、すべてのコンテンツまたはコンテンツの一部を配信する通常のリクエストです。 |
| 自動化用の HTTP ライブラリ | 次のものが含まれます。 | 例：<br>・Amazon CloudFront<br>・Apache Http Client<br>・非同期 Http クライアント<br>・Axios<br>・アズレウス<br>・Curl<br>・GitHub ノードフェッチ<br>・Guzzle<br>・Go-http-client<br>・ヘッドレスクロム<br>・ Java™ Client<br>・ジャージー<br>・Node Oembed<br>・okhttp<br>・Python リクエスト<br>・Reactor Netty<br>・Wget<br>・WinHTTP |
| 監視ツールおよびヘルスチェックツール | 次のものが含まれます。 | これらは、サイトの特定の側面を監視するために顧客が設定します。例えば、可用性や実際のユーザーパフォーマンスなどです。サイトからの実際の HTML ページではなく、`/system/probes/health` エンドポイントを使用します。<br>例：<br>・Amazon-Route53-Health-Check-Service<br>・EyeMonIT_bot_version_0.1_[（https://www.eyemon.it/）](https://www.eyemon.it/)<br>・Runvison-Site24 x 7<br>・Mozilla/5.0 以降（互換；UptimeRobot/2.0；[https://uptimerobot.com/](https://uptimerobot.com/)）<br>・SoundEyes-Dragonfly-x1<br>・OmtrBot/1.0<br>・WebMon/2.0.0 |
| `<link rel="prefetch">` リクエスト | 次のものが含まれます。 | 次のページの読み込み速度を上げるには、ユーザーがリンクをクリックする前にブラウザーで一連のページを読み込むように設定し、既にキャッシュに存在している必要があります。*注意：これにより、取得されるこれらのページの数に応じて、トラフィックが大幅に増加します*。 |
| Adobe Analytics または Google Analytics レポートをブロックするトラフィック | 次のものが含まれます。 | サイトの訪問者が、Google Analytics や Adobe Analytic sの正確性に影響を与えるプライバシーソフトウェア（広告ブロッカーなど）をインストールしていることがよくあります。AEM as a Cloud Service は、クライアントサイドではなく、アドビが運用するインフラストラクチャへの最初のエントリポイントに対するリクエストをカウントします。 |

[ライセンスダッシュボード](/help/implementing/cloud-manager/license-dashboard.md)も参照してください。

### 除外されたコンテンツリクエストのタイプ {#excluded-content-request}

| リクエストタイプ | コンテンツリクエスト | 説明 |
| --- | --- | --- |
| HTTP Code 500+ | 除外済み | AEM as a Cloud Service または顧客カスタムコードで問題が発生した場合に、訪問者にエラーが返されました。 |
| HTTP コード 400-499 | 除外済み | コンテンツが存在しない（404）場合や、その他のコンテンツまたはリクエスト関連の問題がある場合に、訪問者にエラーが返されました。 |
| HTTP コード 300-399 | 除外済み | これらは、サーバー上で何かが変更されたかを確認する、または別のリソースにリクエストをリダイレクトする適切なリクエストです。コンテンツ自体が含まれていないので、課金対象になりません。 |
| /libs/* に移動するリクエスト | 除外済み | AEM の内部 JSON リクエスト（課金対象でない CSRF トークンなど）。 |
| DDoS 攻撃からのトラフィック | 除外済み | DDoS 保護。AEM は一部の DDoS 攻撃を自動検出しブロックします。DDoS 攻撃は、検出された場合、課金対象ではありません。 |
| AEM as a Cloud Service NewRelic 監視 | 除外済み | AEM as a Cloud Service グローバル監視。 |
| 顧客が Cloud Service プログラムを監視するための URL | 除外済み | 可用性を外部で監視するための推奨 URL。<br><br>`/system/probes/health` |
| AEM as a Cloud Service ポッドウォームアップサービス | 除外済み | ユーザーエージェント： skyline-service-warmup/1* |
| よく知られている検索エンジン、ソーシャルネットワーク、HTTP ライブラリ（Fastly によってタグ付け） | 除外済み | サイトを定期的に訪問し、検索インデックスやサービスを更新するよく知られたサービス：<br><br>例：<br>・ AddSearchBot<br>・ AhrefsBot<br>・ Applebot<br>・ Ask Jeeves Corporate Spider<br>・ Bingbot<br>・ BingPreview<br>・ BLEXBot<br>・ BuiltWith<br>・ Bytespider<br>・ CrawlerKengo<br>・ Facebookexternalhit<br>・ Google AdsBot<br>・ Google AdsBot Mobile<br>・ Googlebot<br>・ Googlebot Mobile<br>・ lmspider<br>・ LucidWorks<br>・ MJ12bot<br>・ Pingdom<br>・ Pinterest<br>・ SemrushBot<br>・ SiteImprove<br>・ StashBot<br>・ StatusCakes<br>・ YandexBot |
| コマース統合フレームワーク呼び出しの除外 | 除外済み | これらは、二重カウントを避けるために、AEM に対して行われたリクエストで、Commerce Integration Framework に転送されます（URL は `/api/graphql` で始まります）。これらは Cloud Service の請求対象ではありません。 |
| `manifest.json` を除外 | 除外済み | マニフェストは API 呼び出しではなく、デスクトップまたは携帯電話に web サイトをインストールする方法に関する情報を提供するためにここに記載されています。アドビは `/etc.clientlibs/*/manifest.json` に対する JSON リクエストをカウントするべきではありません |
| `favicon.ico` を除外 | 除外済み | 返されるコンテンツは HTML や JSON ではありませんが、SAML 認証フローなどのシナリオでは、favicon が HTML として返される場合があるので、カウントから明示的に除外されることがわかります。 |

## クライアントサイドのコレクション {#cliendside-collection}

### AEM as a Cloud Service のリアルユーザーモニタリングサービス {#real-user-monitoring-service-for-aem-as-a-cloud-service}

>[!INFO]
>
>この機能は、早期導入プログラムでのみ利用できます。
>RUM データサービスを有効にするには、AEM Cloud Service バージョン **2023.11.14227** 以降を使用する必要があります。

### 概要 {#overview}

リアルユーザーモニタリングサービスは、web サイトまたはアプリケーションのデジタルユーザーエクスペリエンスをリアルタイムでキャプチャして分析する、パフォーマンス監視テクノロジの一種です。Web アプリケーションのリアルタイムのパフォーマンスを可視化し、エンドユーザーエクスペリエンスに関する正確なインサイトを提供します。

リアルユーザーモニタリングサービスは、URL の開始からリクエストがブラウザーに返されるまで、主要なパフォーマンス指標に対する詳細なインサイトを提供します。これはすべて、開発者がアプリケーションを強化してエンドユーザーが使いやすいようにするのに役立ちます。

### リアルユーザーモニタリングサービスのメリットを享受できるユーザー {#who-can-benefit-from-rum-service}

RUM データサービスは、アドビの CDN を利用するか、独自の CDN を利用するかに関わらず、すべてのお客様にとって有益です。ユーザーのインタラクションをより正確に反映させ、クライアントサイドでのページビュー数を反映することで、web サイトのエンゲージメントを確実に測定できます。

特に Adobe CDN ユーザーの場合、ユーザーの操作を正確に追跡して、クライアントサイドのページビューとサーバーサイドの CDN ログを直接比較します。

独自の CDN を採用しているお客様は、アドビがこれらのページビューを直接統合することで、個別のレポートが必要なくなり、簡素化されたトラフィックレポートを利用できます。

さらに、すべてのお客様はページのパフォーマンスに関する深いインサイトを得ることで、デジタルエクスペリエンスを効果的に最適化できます。

### リアルユーザーモニタリングサービスの仕組みについて {#understand-how-the-rum-service-works}

Adobe Experience Manager は、リアルユーザーモニタリング（RUM）を使用して、訪問者が Adobe Experience Manager を活用したサイトとやり取りする方法をお客様とアドビが理解し、パフォーマンスの問題を診断し、実験の効果を測定するのに役立ちます。RUM では、サンプリング（すべてのページビューのごく一部のみをモニタリング）と、すべての個人を特定できる情報（PII）の適切な除外を通じて、訪問者のプライバシーを保護します。

### リアルユーザーモニタリングサービスとプライバシー {#rum-service-and-privacy}

Adobe Experience Manager のリアルユーザーモニタリングサービスは、訪問者のプライバシーを保護し、データ収集を最小限に抑えるように設計されています。つまり、訪問者として、訪問しているサイトによって個人情報が収集されたり、アドビに提供されたりすることはありません。

サイトオペレーターとして、この機能を通じてモニタリングを有効にするためにオプトインを追加する必要はないので、エンドユーザーが RUM モニタリングを有効にするために追加のポップアップを受け入れる必要はありません。

### リアルユーザーモニタリングサービスのデータサンプリング {#rum-service-data-sampling}

従来の web 分析ソリューションでは、すべての訪問者に関するデータを収集しようとします。Adobe Experience Manager のリアルユーザーモニタリングサービスでは、ページビューのごく一部からの情報のみをキャプチャします。リアルユーザーモニタリングサービスは、分析の代替ではなく、サンプリングと匿名化を目的としています。デフォルトでは、ページのサンプリングレートは 1:100 です。現時点では、サイトオペレーターはこの数値を設定してサンプリングレートを増減できません。合計トラフィックを正確に推定するために、100 ページビューごとに詳細なデータを収集し、全体のトラフィックの信頼できる近似値を提供します。

データが収集されるかどうかはページビューごとに決定されるので、複数のページ間のインタラクションを追跡することは事実上不可能になります。RUM には、訪問、訪問者、セッションの概念がなく、ページビューのみが含まれます。これは仕様によるものです。

### 収集されるデータ {#what-data-is-being-collected}

リアルユーザーモニタリングサービスは、個人を特定できる情報の収集を防ぐように設計されています。Adobe Experience Manager のリアルユーザーモニタリングサービスで収集できる完全な情報セットを以下に示します。

* 訪問しているサイトのホスト名（例：`experienceleague.adobe.com`）
* デスクトップやモバイルなど、ページの表示に使用される幅広いユーザーエージェントタイプ
* `2021-06-26 06:00:02.596000 UTC (in order to preserve privacy, we round all minutes to the previous hour, so that only seconds and milliseconds are tracked)` など、データ収集の時間
* 訪問しているページの URL（例：`https://experienceleague.adobe.com/docs`）
* リファラー URL（ユーザーがリンクをたどった場合、現在のページにリンクしているページの URL）
* `2Ac6` のような形式で、ランダムに生成されたページビューの ID
* `100` など、サンプリングレートの重み付けまたはその逆つまり、100 ページビューのうち 1 つしか記録されません
* チェックポイント（ページの読み込みシーケンスまたは訪問者としてのページとのやり取りのシーケンスにおける特定のイベントの名前）
* ソース（上記のチェックポイントでユーザーがやり取りする DOM 要素の識別子）。例えば、これは画像の可能性があります
* ターゲット（上記のチェックポイントでユーザーがやり取りする外部ページまたはリソースへのリンク）。例：`https://blog.adobe.com/jp/publish/2022/06/29/media_162fb947c7219d0537cce36adf22315d64fb86e94.png`
* 訪問者のエクスペリエンスの質を表すコア web バイタル（CWV）パフォーマンス指標、最大コンテンツの描画（LCP）、初回入力遅延（FID）および累積レイアウトシフト（CLS）。

### リアルユーザーモニタリングサービスの設定方法 {#how-to-set-up-the-rum-service}

* 早期導入プログラムへの参加をご希望の場合は、Adobe ID に関連付けられたメールアドレスから、実稼動環境、ステージ環境、開発環境のドメイン名を添えて `aemcs-rum-adopter@adobe.com` にメールを送信してください。その後、アドビの製品チームが、リアルユーザーモニタリング（RUM）データサービスを有効にします。
* これが完了すると、アドビの製品チームは顧客共同作業チャネルを作成します。
* アドビの製品チームは、クライアントサイドのリアルユーザーモニタリングサービスのコレクションによって収集されたページビューと、[コア web バイタル（CWV）](https://web.dev/vitals/)指標を表示できるドメインキーとデータダッシュボード URL を提供するためにお客様に連絡します。
* 次に、ドメインキーを使用してデータダッシュボード URL にアクセスし、指標を表示する方法について説明します。

### リアルユーザーモニタリングサービスのデータ使用方法 {#how-rum-service-data-is-being-used}

RUM データは、次の目的で有益です。

* お客様のサイトに対してパフォーマンスのボトルネックを特定および修正する
* 独自の CDN を使用するお客様向けに、ページビューを含む効率化された自動トラフィックレポートを提供する（つまり、トラフィックレポートをアドビと共有する必要がありません）
* 互換性を高めるために、Adobe Experience Manager で同じページ上の他のスクリプト（分析、ターゲティング、外部ライブラリなど）とやり取りする方法を理解する

### ページビューおよびパフォーマンス指標の制限事項と差異について {#limitations-and-understanding-variance-in-page-views-and-performance-metrics}

このデータを分析すると、リアルユーザーモニタリング（RUM）でレポートされるページビューやその他のパフォーマンス指標に差異が生じる場合と生じない場合があります。これらの差異は、リアルタイムのクライアントサイドのモニタリングに固有のいくつかの要因に起因する可能性があります。お客様が RUM データを解釈する際に留意すべき重要な考慮事項を以下に示します。

1. **トラッカーブロッカー**

   * エンドユーザーがトラッカーブロッカーやプライバシー拡張機能を使用すると、これらのツールはトラッキングスクリプトの実行を制限するので、リアルユーザーモニタリングサービスのデータ収集が妨げられる可能性があります。この制限により、ページビューやユーザーインタラクションが過小レポートされる可能性があり、実際のサイトアクティビティと RUM によってキャプチャされたデータとの間に不一致が生じる可能性があります。

1. **API／JSON 呼び出しの取得に関する制限事項**

   * RUM データサービスはクライアントサイドのエクスペリエンスに重点を置いており、現時点ではバックエンド API や JSON 呼び出しをキャプチャしません。リアルユーザーモニタリングサービスのデータからこれらの呼び出しを除外すると、CDN 分析によって測定されるコンテンツリクエストとの差異が生じます。

### FAQ {#faq}

1. **モニタリングに含めたり除外したりするパスを設定するにはどうすればよいですか？**

   お客様は、Cloud Manager の設定内で変数 `AEM_WEBVITALS_EXCLUDE` および `AEM_WEBVITALS_INCLUDE_PATHS` を使用して環境変数を設定することで、モニタリング対象の URL を含めるか除外するパスを設定できます。

   デフォルトでは、「include」設定は「/content」を対象とするように設定されます。ここで設定する必要があるパスは、ブラウザーに表示される URL パスではなく、システム内のコンテンツパスであることに留意することが重要です。この違いは、特定のニーズを満たすように正確に設定およびカスタマイズするための鍵となります。

1. **アドビでは、顧客の管理による CDN にインタラクションが到達する前、またはインタラクションが到達した時点で、すべてのページビューをトラックできますか？**

   はい。

1. **お客様は、RUM データサービススクリプトを Dynatrace などのサードパーティシステムと統合できますか？**

   はい。

1. **「次のペイントまでのインタラクション（INP）」、「最初のバイトまでの時間（TTFB）」および「コンテンツの初回ペイント（FCP）」の web バイタル指標を収集していますか？**

   次のペイントまでのインタラクション（INP）と最初のバイトまでの時間（TTFB）を収集します。現時点では、コンテンツの初回ペイント（FCP）は収集しません。
