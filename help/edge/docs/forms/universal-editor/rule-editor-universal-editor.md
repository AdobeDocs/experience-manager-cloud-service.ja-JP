---
title: ユニバーサルエディターの動的Forms用のルールエディター
description: ユニバーサルエディターのルールエディターを使用して、動的でインテリジェントなフォームを作成します。 コーディングなしで、条件付きロジック、計算、インタラクティブ動作を追加します。
feature: Edge Delivery Services
role: Admin, Architect, Developer
level: Intermediate
exl-id: 846f56e1-3a98-4a69-b4f7-40ec99ceb348
source-git-commit: ccfb85da187e828b5f7e8b1a8bae3f483209368d
workflow-type: tm+mt
source-wordcount: '3597'
ht-degree: 23%

---


# ユニバーサルエディターの動的Forms用のルールエディター

ユニバーサルエディターのルールエディターを使用すると、ユーザーの入力にリアルタイムで応答する、インテリジェントで動的なフォームを作成できます。 静的フォームを、条件付きフィールドの表示、自動計算、複雑なビジネスロジックを備えたインタラクティブエクスペリエンスに変換できます。しかも、コードを記述する必要はありません。


## 学習内容

このガイドを終了すると、次のことができるようになります。

- ルールの仕組みと、様々なルールタイプを使用するタイミングについて
- ユニバーサルエディターでのルールエディターの有効化とルールエディターへのアクセス
- 条件付きロジックを作成して、フォームフィールドを動的に表示または非表示にする
- 自動計算とデータ検証の実装
- 複雑なビジネスルールのカスタム関数の作成
- 最適なフォームパフォーマンスへのベストプラクティスの適用

## ルールエディターを使用する理由

**静的なFormsをスマートエクスペリエンスに変換：**

- **条件付きロジック**：ユーザーの選択に基づいて関連フィールドを表示します
- **動的計算**：ユーザーの入力時に値を自動的に計算します。
- **データ検証**：リアルタイムのフィードバックを提供し、エラーを防ぎます
- **UX の向上**：フォームの複雑さを軽減し、論理フローをガイドします
- **コーディングは必要ありません**：デベロッパー以外のユーザーがアクセスできるビジュアルインターフェイス

**一般的なユースケース：**

- 条件付き控除を含む税金計算フォーム
- 分岐パスを持つ複数手順のウィザード
- 料率を計算する保険フォーム
- 条件付き質問を含む調査フォーム
- 動的な価格設定の e コマースフォーム

## ルールの仕組み

ルールは、フォームをインテリジェントでレスポンシブにする自動の手順です。 特定の条件が満たされた場合に何が起こるかを指定します。

### **ルールコンポーネント**

**条件**:true または false と評価される論理テスト。

- 「ユーザーの収入が 5 万ドルを超えていますか？」
- 「ユーザーは保険の適用に「はい」を選択しましたか？」
- 「フォームフィールドは空ですか？」

**アクション**：条件が満たされたときに発生する結果。

- フォームフィールドの表示/非表示を切り替える
- 値を自動計算
- 検証メッセージを表示
- コンポーネントを有効または無効にする

### **ルールの論理パターン**

**1. 条件 – アクション（When-Then）**

```
WHEN gross salary > 50000
THEN show "Additional Deduction" field
```

*最適な対象：* 条件付きフィールドの表示、動的コンテンツ

**2. アクション条件（Set-If）**

```
SET taxable income = gross salary - deductions
IF deductions are applicable
```

*最適な対象：* 計算、データ変換

**3. アクション – 条件 – 代替（If-Then-Else）**

```
IF income > 50000
THEN show "High Income" fields
ELSE show "Standard Income" fields
```

*最適な対象：* 分岐ロジック、相互に排他的なオプション

### **実際の例**

**シナリオ**：税金計算フォーム

- **条件**:「総給与が 5 万ドルを超える」
- **プライマリ操作**: [ 追加控除 ] フィールドを表示します
- **代替アクション**:「追加控除」フィールドを非表示にします
- **結果**：ユーザーには、収入レベルに基づいた関連フィールドのみが表示されます

## 前提条件

ルールエディターを使用する前に、次の点を確認してください。

### **アクセス要件**

- **AEM as a Cloud Service** へのアクセス権のオーサリング
- ルールエディター拡張機能が有効な **ユニバーサルエディター**
- AEM環境でのフォーム編集権限

### **技術的要件**

- **基本的なフォームデザインの知識**：フォームコンポーネントとそのプロパティについて理解している
- **ビジネスロジックの使いやすさ**：条件付き要件を定義する機能
- **JavaScriptの基本知識** （カスタム関数でのみ必要）

### **ルールエディター拡張機能の有効化**

ユニバーサルエディターでは、ルールエディター拡張機能はデフォルトで有効になっていません。[Extension Manager](/help/implementing/developing/extending/extension-manager.md) から有効にできます。

**拡張機能を有効にした後：**
フォームコンポーネントを選択すると、右上隅に「![edit-rules](/help/forms/assets/edit-rules-icon.svg)」アイコンが表示されます。

![ ユニバーサルエディターのルールエディター ](/help/edge/docs/forms/assets/universal-editor-rule-editor.png)
*図：フォームコンポーネントを選択すると、ルールエディターアイコンが表示される*

**ルールエディターにアクセスするには：**

1. ユニバーサルエディターで任意のフォームコンポーネントを選択します。
2. 表示される ![edit-rules](/help/forms/assets/edit-rules-icon.svg) アイコンをクリックします。
3. ルールエディターインターフェイスが新しいパネルに開きます。

![ ルールエディターのユーザーインターフェイス ](/help/edge/docs/forms/assets/rule-editor-for-field.png)
*図：コンポーネントルールを編集するためのルールエディターインターフェイス*

>[!NOTE]
>
> この記事全体を通して、「フォームコンポーネント」と「フォームオブジェクト」は同じ要素（入力フィールド、ボタン、パネルなど）を参照します。

## ルールエディターインターフェイスの概要

ルールエディターは、ルールを作成および管理するための使いやすいビジュアルインターフェイスを提供します。

![ ルールエディターのユーザーインターフェイス ](/help/edge/docs/forms/assets/rule-editor-interface.png)
*図：番号付きコンポーネントを含む完全なルールエディターインターフェイス*

### **インターフェイスコンポーネント**

**1. コンポーネントのタイトルとルールタイプ**

- **目的**：選択したコンポーネントの名前と現在のルールタイプが表示されます。
- **例**:「When」ルールが選択された「Gross Salary （総給与を入力）」（テキスト入力）
- **ヒント**：常に正しいコンポーネントを編集していることを確認します。

**2. フォームオブジェクトと関数パネル**

- **「フォームオブジェクト」タブ**：すべてのフォームコンポーネントの階層ビューが表示されます。
   - 使用対象：ルール内の他のフィールドを参照します。
   - ナビゲーション：展開または折りたたみを行って、特定のコンポーネントを配置します。
- **「関数」タブ**：組み込みの数学関数と論理関数が含まれます。
   - 用途：複雑な計算やデータ操作の実行。
   - カテゴリ：数学、文字列、日付、および検証関数。

**3. パネル切り替えボタン**

- **目的**：オブジェクトおよび関数パネルの表示/非表示を切り替えます。
- **ヒント**：パネルをオフにして、ルール編集ワークスペースを増やします。
- **キーボードショートカット**：複雑なルールを操作する場合に役立ちます。

**4. ビジュアルルールビルダー**

- **目的**：ルールロジックを構築するためのメイン領域です。
- **機能**：ドラッグ&amp;ドロップインターフェイスおよびドロップダウンセレクター。
- **ワークフロー**：条件を定義してアクション→設定するルールタイプ→選択します。

**5. コントロール ボタン**

- **完了**：ルールを保存し、エディターを閉じます。
- **キャンセル**：変更を破棄し、保存せずにエディターを閉じます。
- **ヒント**:「完了」をクリックする前に、常にルールをテストします。

### **ルールの管理**

ルールが既に設定されているコンポーネントのルールエディターを開くとき：

![ フォームオブジェクトの使用可能なルールを表示する ](/help/edge/docs/forms/assets/rule-editor15.png)
*図：フォームコンポーネントの既存ルールの管理*

**使用可能なアクション：**

- **表示**：ルールの概要とロジックを確認します。
- **編集**：既存のルールの条件またはアクションを変更します。
- **並べ替え**：ルールの実行順序を変更します（ルールは上から下に実行されます）。
- **有効/無効**：テスト目的で、ルールのオン/オフを一時的に切り替えます。
- **削除**：ルールを完全に削除します。

>[!TIP]
>
> **ルールの実行順序が重要**：ルールは上から順に実行されます。 一般的な条件の前に、より具体的な条件を配置します。

## 利用可能なルールタイプ

ルールエディターでは、機能別に整理された包括的なルールタイプのセットを提供します。 特定の使用例に基づいて適切なタイプを選択します。

### **条件付きロジック・ルール**

**When**

- **目的**：複雑なロジックを実装するための主要な条件付きルールとして機能します。
- **ユースケース**：例：「ユーザーが「既婚」を選択した場合、配偶者情報フィールドを表示する」
- **論理パターン**：条件→アクション（オプションの代替アクションを含む）

**非表示/表示**

- **目的**：指定した条件に基づいてフィールドの表示を制御します。
- **ユースケース**：無関係なセクションを非表示にしたり、プログレッシブ開示を有効にしたりします。
- **ベストプラクティス**：を使用して、クリーンで焦点を当てたユーザーエクスペリエンスを作成します。

**Enable/Disable**

- **目的**：条件に基づいて、フィールドを操作できるかどうかを制御します。
- **ユースケース**：すべての必須フィールドに入力するまで、「送信」ボタンを無効にします。
- **ベストプラクティス**：ユーザーに明確で視覚的なフィードバックを提供します。

### **データ操作規則**

**Set Value Of**

- **目的**：フィールド値を自動的に入力します。
- **ユースケース**：今日の日付を設定したり、合計を計算したり、フィールド間で値をコピーしたりします。
- **ベストプラクティス**：を使用すると、ユーザーの手間を軽減し、精度を確保できます。

**値をクリア**

- **目的**：条件が変更されたときにフィールドからデータを削除します。
- **ユースケース**：親選択が変更されたときに依存フィールドをクリアする。
- **ベストプラクティス**：データの整合性を維持し、値の孤立を防ぐ。

**形式**

- **目的**：値の表示方法を変換します。
- **ユースケース**：通貨、電話番号または日付を書式設定する。
- **ベストプラクティス**：基になるデータを変更せずに、読みやすさを向上させます。

### **検認規程**

**Validate（検証）**

- **目的**：カスタム検証ロジックを実装します。
- **使用例**：複雑なビジネスルールまたはクロスフィールド検証を適用する。
- **ベストプラクティス**：明確で実用的なエラーメッセージを提供します。

### **計算規程**

**数式**

- **目的**：自動計算を実行します。
- **ユースケース**：税金計算、合計またはパーセンテージ。
- **ベストプラクティス**：ユーザーが入力したときにリアルタイムで計算を更新する。

### **ユーザインタフェースルール**

**フォーカスの設定**

- **目的**：特定のフィールドにユーザーの注意を誘導します。
- **ユースケース**：エラーフィールドに焦点を当てるか、ユーザーにウィザードの手順を説明します。
- **ベストプラクティス**：ユーザーフローを中断しないように、使用は慎重に行ってください。

**プロパティの設定**

- **目的**：コンポーネントプロパティを動的に変更します。
- **ユースケース**：プレースホルダーテキストを変更したり、ドロップダウンでオプションを変更したりします。
- **ベストプラクティス**：コンテキストの変更により、ユーザーエクスペリエンスを向上させます。

### **フォームコントロールのルール**

**送信フォーム**

- **目的**:トリガーフォームをプログラムで送信します。
- **ユースケース**：特定の条件が満たされた後に自動送信。
- **ベストプラクティス**：常に送信前にフォームを検証します。

**フォームをリセット**

- **目的**：すべてのフォームデータをクリアし、フォームを初期状態にリセットします。
- **ユースケース**:「やり直し」機能。
- **ベストプラクティス**：リセットする前に、ユーザーにアクションを確認してください。

**フォームを保存**

- **目的**：後で完了するために、フォームをドラフトとして保存します。
- **ユースケース**：ロングフォームやマルチセッションワークフローで役立ちます。
- **ベストプラクティス**：保存ステータスに関する明確なフィードバックを提供します。

### **詳細ルール**

**サービスを起動**

- **目的**：外部の API またはサービスを呼び出します。
- **ユースケース**：アドレスルックアップ、リアルタイム検証、データエンリッチメント。
- **ベストプラクティス**：読み込み状態とエラーシナリオを適切に処理します。

**インスタンスの追加/削除**

- **目的**：繰り返し可能なセクションを動的に管理します。
- **ユースケース**：ファミリーメンバーまたは複数のアドレスを追加する。
- **ベストプラクティス**：インスタンスの追加または削除を明確に制御する。

**次に移動**

- **目的**：ユーザーを他のフォームやページにリダイレクトします。
- **ユースケース**：マルチフォームワークフローまたは条件付きルーティング。
- **ベストプラクティス**：ナビゲーション前にフォームデータを保持する。

**パネル間の移動**

- **目的**：ウィザード形式のフォームのナビゲーションを制御します。
- **ユースケース**：複数ステップのフォームまたは条件付きステップのスキップ。
- **ベストプラクティス**：明確な進捗インジケーターを表示する。

**イベントのディスパッチ**

- **目的**：高度な統合用のカスタムイベントをトリガーにします。
- **ユースケース**:Analytics トラッキングまたはサードパーティ統合。
- **ベストプラクティス**：ノンブロッキングアクションにのみ使用してください。


## ステップバイステップのチュートリアル：Smart Tax Calculator の作成

この節では、ルールエディターの機能を示す実践的な例を示します。 この例では、条件付きロジックと自動計算を使用する税金計算フォームの構築を順を追って説明します。

![ フォームフィールド表示の「When-Then」ロジックを含む条件付きルールの作成を示すルールエディターインターフェイスのスクリーンショット ](/help/edge/docs/forms/assets/rule-editor-1.png)
*図：インテリジェントな条件付きフィールドを備えた税金計算フォーム*

### **チュートリアルの概要**

このチュートリアルでは、次の操作を実行するフォームを作成します。

1. **ユーザー入力に適応**：収入レベルに基づいて関連フィールドを表示します。
2. **自動計算**：納税義務をリアルタイムで計算します。
3. **データを検証**：正確な計算とデータ入力を保証します。

### **フォームの構造**

| フィールド名 | タイプ | 目的 | 動作 |
|------------|------|---------|----------|
| **総給与** | 数値入力 | 年収を入力したユーザー | トリガーの条件付きロジック |
| **追加控除** | 数値入力 | 追加控除（該当する場合） | 給与 > $50,000 の場合に表示します |
| **課税所得** | 数値入力 | 自動的に計算 | 入力の変更に関する更新 |
| **未払税** | 数値入力 | 最終税額 | 10% の割合で計算します。 |

### **実装するビジネスロジック**

**ルール 1：条件付きフィールドの表示**

```
WHEN Gross Salary > 50,000
THEN Show "Additional Deduction" field
ELSE Hide "Additional Deduction" field
```

**規則 2：課税所得計算**

```
SET Taxable Income = Gross Salary - Additional Deduction
(When Additional Deduction is applicable)
```

**規則 3：税金計算**

```
SET Tax Payable = Taxable Income × 10%
(Simplified flat rate for demonstration)
```

### **実装の手順**

次の手順に従って、インテリジェントな税金フォームを作成します。



+++ 1：基盤フォームの作成

**目的**：すべての必要なコンポーネントを使用して、基本的なフォーム構造を構築します

ユニバーサルエディターで税金計算フォームを作成するには：

1. **ユニバーサルエディターを開く**
   - AEM Sites コンソールに移動します
   - フォームを追加するページを選択します
   - 「**編集**」をクリックして、ユニバーサルエディターを開きます

2. **フォームコンポーネントの追加**

   以下のコンポーネントを順番に追加します。

   | コンポーネント | タイプ | ラベル | 設定 |
   |-----------|------|-------|----------|
   | タイトル | タイトル | 「税金計算フォーム」 | 見出しレベル H2 |
   | 数値入力 | 数値入力 | 「グロス・サラリー」 | 必須：はい、プレースホルダ：「年収を入力」 |
   | 数値入力 | 数値入力 | 「追加控除」 | 必須：いいえ、プレースホルダー：「追加控除項目の入力」 |
   | 数値入力 | 数値入力 | 「課税所得」 | 必須：いいえ、読み取り専用：はい |
   | 数値入力 | 数値入力 | 「未払い税金」 | 必須：いいえ、読み取り専用：はい |
   | 送信ボタン | 送信 | 「税金の計算」 | タイプ：送信 |

3. **初期設定の指定**

   - **追加控除フィールドの非表示**:
      - 「追加控除」コンポーネントを選択します
      - プロパティパネルで、**表示** を **いいえ** に設定します。
      - このフィールドはルールに基づいて条件付きで表示されます

   - **計算フィールドを読み取り専用にする**:
      - 「課税所得」フィールドと「支払税」フィールドを選択します
      - プロパティで **読み取り専用** を **はい** に設定します

     ![ルールが適用される前のフォーム構造を示す、総給与、婚姻ステータス、扶養子の入力フィールドを備えた税金計算フォームのスクリーンショット](/help/edge/docs/forms/assets/rule-editor2.png)
     *図：基本コンポーネントが設定された初期フォーム構造*

**チェックポイント**：これで、すべての必須フィールドを含んだフォームが作成されました。「追加控除」は非表示になっており、計算フィールドは読み取り専用です。

+++

+++ &#x200B;2. フォームフィールドの条件付きルールを追加

フォームを作成したら、総給与が 50,000 ドルを超える場合にのみ「`Additional Deduction`」フィールドを表示する最初のルールを記述します。条件付きルールを追加するには：

1. 編集用にユニバーサルエディターでフォームを開き、コンテンツツリーで「**[!UICONTROL 総給与]**」フィールドを選択して、「![ルールを編集](/help/forms/assets/edit-rules-icon.svg)」を選択します。または、**[!UICONTROL フォームオブジェクト]**&#x200B;パネルから「**[!UICONTROL 総給与]**」フィールドを直接選択することもできます。
   ![ルールエディターの例 1](/help/edge/docs/forms/assets/rule-editor3.png)
ビジュアルルールエディターのインターフェイスが表示されます。
1. 「**[!UICONTROL 作成]**」をクリックして、ルールを作成します。
   ![ルールエディターの例 2](/help/edge/docs/forms/assets/rule-editor4.png)
デフォルトでは、`Set Value Of` ルールタイプが選択されます。選択したオブジェクトを変更または修正できませんが、ルールドロップダウンを使用して別のルールタイプを選択できます。\
   ![ルールエディターの例 3](/help/edge/docs/forms/assets/rule-editor5.png)
1. ルールタイプドロップダウンリストを開き、**[!UICONTROL When]** ルールタイプを選択します。
   ![ルールエディターの例 4](/help/edge/docs/forms/assets/rule-editor6.png)
1. **[!UICONTROL 状態の選択]**&#x200B;ドロップダウンを選択し、「**[!UICONTROL 次の値より大きい]**」を選択します。「**[!UICONTROL 数値を入力]**」フィールドが表示されます。
   ![ルールエディターの例 5](/help/edge/docs/forms/assets/rule-editor7.png)
1. ルールの「**[!UICONTROL 数値を入力]**」フィールドに `50000` を入力します。
   ![ルールエディターの例 6](/help/edge/docs/forms/assets/rule-editor8.png)
条件を `When Gross Salary is greater than 50000` と定義しました。次に、この条件が `True` の場合に実行するアクションを定義します。
1. `Then` ステートメントで、**[!UICONTROL アクションを選択]**&#x200B;ドロップダウンから「**[!UICONTROL 表示]**」を選択します。
   ![ルールエディターの例 7](/help/edge/docs/forms/assets/rule-editor9.png)
1. 「**[!UICONTROL オブジェクトをドロップするか、または次から選択]**」フィールドの「フォームオブジェクト」タブから「**[!UICONTROL 追加控除]**」フィールドをドラッグ＆ドロップします。あるいは、「**[!UICONTROL オブジェクトをドロップするか、または次から選択]**」フィールドを選択し、ポップアップメニューから「**[!UICONTROL 追加控除]**」フィールドを選択します。この中には、フォーム内のすべてのフォームオブジェクトが一覧表示されます。
   ![ルールエディターの例 8](/help/edge/docs/forms/assets/rule-editor10.png)
1. `50000` 未満の給与を入力した場合は、「**[!UICONTROL Else セクションを追加]**」をクリックして、「**[!UICONTROL 総給与]**」フィールドに別の条件を追加します。
   ![ルールエディターの例 9](/help/edge/docs/forms/assets/rule-editor11.png)
1. `Else` ステートメントの&#x200B;**[!UICONTROL アクションを選択]**&#x200B;ドロップダウンから「**[!UICONTROL 非表示]**」を選択します。
   ![ルールエディターの例 10](/help/edge/docs/forms/assets/rule-editor12.png)
1. 「**[!UICONTROL オブジェクトをドロップするか、または次から選択]**」フィールドの「フォームオブジェクト」タブから「**[!UICONTROL 追加控除]**」フィールドをドラッグ＆ドロップします。あるいは、「**[!UICONTROL オブジェクトをドロップするか、または次から選択]**」フィールドを選択し、ポップアップメニューから「**[!UICONTROL 追加控除]**」フィールドを選択します。この中には、フォーム内のすべてのフォームオブジェクトが一覧表示されます。
   ![ルールエディターの例 11](/help/edge/docs/forms/assets/rule-editor13.png)
1. 「**[!UICONTROL 完了]**」を選択し、ルールを保存します。
ルールエディターでは、ルールが次のように表示されます。
   ![ルールエディターの例 12](/help/edge/docs/forms/assets/rule-editor14.png)

>[!NOTE]
>
> または、「総給与」フィールドに When ルールを記述する代わりに、「追加控除」フィールド上に Show ルールを記述して、同じ動作を実装することもできます。

+++

+++ &#x200B;3. フォームフィールドの計算ルールを追加

次に、`Gross Salary` と `Additional Deduction` の差である `Taxable Income` を計算するルールを記述します（該当する場合）。「**[!UICONTROL 課税所得]**」フィールドに計算ルールを追加するには、次の手順を実行します。

1. オーサリングモードで「**[!UICONTROL 課税所得]**」フィールドを選択し、![ルールを編集](/help/forms/assets/edit-rules-icon.svg) アイコンを選択します。または、**[!UICONTROL フォームオブジェクト]**&#x200B;パネルから「**[!UICONTROL 課税所得]**」フィールドを直接選択することもできます。
1. 次に、「**[!UICONTROL 作成]**」を選択して、ルールを作成します。
   ![ルールエディターの例 13](/help/edge/docs/forms/assets/rule-editor16.png)
1. 「**[!UICONTROL オプションの選択]**」を選択し、「**[!UICONTROL 数式]**」を選択します。数式記述用のフィールドが開きます。
   ![ルールエディターの例 14](/help/edge/docs/forms/assets/rule-editor17.png)

1. 数式フィールドで、次の操作を行います。

   - 最初の「**[!UICONTROL オブジェクトをドロップまたは次から選択]**」フィールドの「**[!UICONTROL 総給与]**」フィールドで、「フォームオブジェクト」タブから選択またはドラッグ＆ドロップします。

   - 「**[!UICONTROL 演算子を選択]**」フィールドから「**[!UICONTROL 減算]**」を選択します。

   - 他の「**[!UICONTROL オブジェクトをドロップまたは次から選択]**」フィールドの「**[!UICONTROL 追加控除]**」フィールドで、「フォームオブジェクト」タブから選択またはドラッグ＆ドロップします。
     ![ルールエディターの例 15](/help/edge/docs/forms/assets/rule-editor18.png)

1. 「**[!UICONTROL 完了]**」を選択し、ルールを保存します。

   次に、課税所得に税率を乗算して決定される「`Tax Payable `」フィールドにルールを追加します。簡素化して固定税率を `10%` と仮定します。

1. オーサリングモードで「**[!UICONTROL 支払税]**」フィールドを選択し、![ルールを編集](/help/forms/assets/edit-rules-icon.svg) アイコンを選択します。次に、「**[!UICONTROL 作成]**」を選択して、ルールを作成します。
   ![ルールエディターの例 16](/help/edge/docs/forms/assets/rule-editor19.png)
1. 「**[!UICONTROL オプションの選択]**」を選択し、「**[!UICONTROL 数式]**」を選択します。数式記述用のフィールドが開きます。
   ![ルールエディターの例 17](/help/edge/docs/forms/assets/rule-editor20.png)
1. 数式フィールドで、次の操作を行います。

   - 最初の「**[!UICONTROL オブジェクトをドロップまたは次から選択]**」フィールドの「**[!UICONTROL 課税所得]**」フィールドで、「フォームオブジェクト」タブから選択またはドラッグ＆ドロップします。

   - 「**[!UICONTROL 演算子を選択]**」フィールドから「**[!UICONTROL 乗算]**」を選択します。

   - 「**[!UICONTROL オプションを選択**」フィールドから「**数値]**」を選択し、「**[!UICONTROL 数値を入力]**」フィールドに `10` のように値を入力します。
     ![ルールエディターの例 18](/help/edge/docs/forms/assets/rule-editor21.png)
1. 次に、式フィールドの周りのハイライト表示された領域を選択し、「**[!UICONTROL 拡張式]**」を選択します。
   ![ルールエディターの例 19](/help/edge/docs/forms/assets/rule-editor22.png)
1. 拡張式フィールドでは、「**[!UICONTROL 演算子を選択]**」フィールドから「**[!UICONTROL 割り算]**」を選択し、「**[!UICONTROL オプションを選択]**」フィールドから「**[!UICONTROL 数字]**」を選択します。次に、数値フィールドに `100` を指定します。
   ![ルールエディターの例 20](/help/edge/docs/forms/assets/rule-editor23.png)
1. 「**[!UICONTROL 完了]**」を選択し、ルールを保存します。

+++

+++ &#x200B;4. フォームをプレビュー

これで、フォームをプレビューし、**総給与**&#x200B;を `60,000` として入力すると、「**追加控除**」フィールドが表示され、それに応じて「**課税所得**」と「**支払税**」が計算されます。

![フォームをプレビュー](/help/edge/docs/forms/assets/rule-editor-form.png)

+++

合計や平均などの組み込み関数の他に、カスタム関数を作成して、特定の要件に合わせて調整された複雑なビジネスロジックを実装できます。

## 詳細：カスタム関数

**カスタム関数を使用する場合：**

- 組み込み関数の機能を超える複雑な計算の場合
- ビジネス固有の検証ルールを実装する手順は、次のとおりです
- データ変換および書式設定の場合
- 外部システムまたは API と統合するには、次の手順に従います

**メリット：**

- **再利用性**：関数を 1 回記述し、複数のフォームやルールで使用します
- **メンテナンス性**：簡単に更新できる一元化されたロジック
- **パフォーマンス**:JavaScriptの実行の最適化
- **柔軟性**：標準ルールで対応できない複雑なシナリオを処理する機能

### **カスタム関数の作成**

**ファイルの場所**:AEM プロジェクト内の `/blocks/form/functions.js`

**開発ワークフロー：**

1. **関数の宣言**
   - 明確でわかりやすい関数名とパラメーターの定義
   - 関数の目的を示す名前を使用します
   - ドキュメントパラメーターと戻り値のタイプ

2. **ロジック実装**
   - クリーンで効率的なJavaScript コードの記述
   - エッジケースとエラーシナリオの処理
   - コーディングのベストプラクティスに従う

3. **関数のエクスポート**
   - 関数を書き出して、ルールエディターで使用できるようにします
   - 名前付き書き出しを使用して組織を向上
   - デプロイメント前に関数をテスト

4. **ドキュメント**
   - 関数ドキュメントへの JSDoc コメントの追加
   - 使用例を含める
   - パラメータータイプと戻り値の指定

次の例は、2 つのカスタム関数 `getFullName` と `days` を示しています。

```JavaScript
/**
 - Get Full Name
 - @name getFullName Concats first name and last name
 - @param {string} firstname in Stringformat
 - @param {string} lastname in Stringformat
 - @return {string}
 */
function getFullName(firstname, lastname) {
  return `${firstname} ${lastname}`.trim();
}

/**
 - Calculate the number of days between two dates.
 - @param {*} endDate
 - @param {*} startDate
 - @name days Calculates the numebr of days between two dates
 - @returns {number} returns the number of days between two dates
 */
function days(endDate, startDate) {
  const start = typeof startDate === 'string' ? new Date(startDate) : startDate;
  const end = typeof endDate === 'string' ? new Date(endDate) : endDate;

  // return zero if dates are valid
  if (Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {
    return 0;
  }

  const diffInMs = Math.abs(end.getTime() - start.getTime());
  return Math.floor(diffInMs / (1000 * 60 * 60 * 24));
}

// eslint-disable-next-line import/prefer-default-export
export { getFullName, days };
```

![カスタム関数の追加](/help/edge/docs/forms/assets/create-custom-function.png)

### ルールエディターでのカスタム関数の使用

ルールエディターでカスタム関数を使用するには：

1. **関数の追加**：カスタム関数を `../[blocks]/form/functions.js` ファイルに追加します。 ファイル内の `export` ステートメントに必ず含めてください。
2. **ファイルをデプロイ**：更新した `functions.js` ファイルを GitHub プロジェクトにデプロイし、ビルドが正常に完了することを確認します。
3. **関数の使用法**：フォームのルールエディターで、「`Function Output` アクションの選択 **[!UICONTROL 」フィールドの「]**」オプションを選択して関数にアクセスします。

   ![ルールエディターでのカスタム関数](/help/edge/docs/forms/assets/custom-function-rule-editor.png)

4. **フォームのプレビュー**：フォームをプレビューして、新しく実装した関数が期待どおりに動作することを確認します。

## ルール開発のベストプラクティス

### **パフォーマンスの最適化**

**ルールの複雑さを最小化**

- 個々のルールをシンプルにし、焦点を当てます。
- 複雑なロジックを複数の小さなルールに分割します。
- 可能な場合は、深くネストされた条件を避けます。

**ルール実行の最適化**

- 最も頻繁にトリガーされるルールを最初に配置します。
- 不要な評価を減らすには、特定の条件を使用します。
- フォームの読み込み時間に対するルールの影響を考慮します。

**リソースの管理**

- フォームコンポーネントごとにルール数を制限します。
- ルールを複製する代わりに、繰り返しロジックにカスタム関数を使用します。
- 現実的なデータ量でパフォーマンスをテストします。

### **ユーザーエクスペリエンスのガイドライン**

**明確なフィードバックの提供**

- 正しい入力に導く検証メッセージを使用します。
- 外部サービスを含むルールの読み込み指標を表示します。
- プログレッシブディスクロージャーを実装して、認知負荷を軽減します。

**フォームの応答性の維持**

- 急激な視覚的変化を引き起こすルールを避ける。
- 表示/非表示操作のスムーズな切り替えを実装します。
- 様々なデバイスや画面サイズでルールをテストします。

**エラー処理**

- ルールが失敗した場合のフォールバック動作を提供します。
- ユーザーにわかりやすいエラーメッセージを表示します。
- 肯定的なユーザーエクスペリエンスを維持しながら、デバッグ用にエラーをログに記録します。

### **開発のベストプラクティス**

**テスト戦略**

- エッジケースと境界値を使用してルールをテストします。
- 異なるブラウザー間でのルールの動作を検証します。
- JavaScriptを有効にした場合と有効にしない場合の両方でフォーム機能をテストします。

**ドキュメント**

- 複雑なルールの背後にあるビジネスロジックの文書化。
- 大きなフォームのルール在庫を管理します。
- コンポーネントとルールには一貫した命名規則を使用します。

**バージョン管理**

- バージョン管理でのカスタム関数の変更を追跡します。
- 実稼動前に、開発環境でルールをテストします。
- 作業ルール構成のバックアップ コピーを管理します。

## よくある問題のトラブルシューティング

### **ルール実行の問題**

**ルールがトリガーされない**

- **コンポーネント名を確認**：参照されるコンポーネントが存在し、正しい名前であることを確認します。
- **ルール順序の検証**：ルールは上から下に実行されます。必要に応じて並べ替えます。
- **条件を検証**：既知の値を使用して条件をテストし、ロジックを検証します。
- **ブラウザーコンソール**：実行がブロックされる可能性のあるJavaScript エラーを確認します。

**ルールの動作が正しくない**

- **論理演算子を確認**:AND/OR 条件が正しく構造化されていることを確認します。
- **サンプルデータを使用したテスト**：既知の値を使用して問題を特定します。
- **データタイプを確認**：数値比較で、文字列ではなく数値が使用されていることを確認します。
- **数式を検証**：数式を個別にテストします。

### **パフォーマンスの問題**

**低速フォームの応答**

- **ルールの複雑さを軽減**：複雑な条件付きロジックを簡素化します。
- **カスタム関数の最適化**:JavaScript コードをプロファイルし最適化します。
- **外部呼び出しを制限**: ルール内のサービス呼び出しを最小限に抑えます。
- **効率的なセレクターの使用**：フォームオブジェクトの参照が固有であることを確認します。

**メモリ使用量**

- **イベントリスナーのクリーンアップ**：未使用のルールバインディングを削除します。
- **カスタム関数の最適化**:JavaScript コードでのメモリリークを回避します。
- **ルール範囲の制限**：グローバル条件の代わりにターゲットルールを使用します。

### **カスタム関数の問題**

**関数を使用できません**

- **ファイル パスの確認**: `functions.js` が正しい場所にあることを確認します：`/blocks/form/functions.js`。
- **書き出しを検証**：関数が正しく書き出されていることを確認します。
- **ビルドプロセス**：更新された関数ファイルがプロジェクトのビルドに含まれていることを確認します。
- **キャッシュクリア**：新しい関数をデプロイした後で、ブラウザーのキャッシュをクリアします。

**関数エラー**

- **パラメーターの検証**：関数のパラメーターが想定されるタイプに一致することを確認します。
- **エラー処理**：例外を適切に処理するための try-catch ブロックを追加します。
- **コンソールログ**：関数の実行をデバッグするには、console.log を使用します。
- **JSDoc 検証**：関数のドキュメントが実装と一致することを確認します。

### **ユニバーサルエディターの統合**

**ルールエディターが表示されない**

- **拡張機能を有効にする**: ルールエディター拡張機能が有効になっていることを確認します。
- **コンポーネントの選択**：サポートされているフォームコンポーネントを選択していることを確認します。
- **ブラウザーの互換性**：サポートされているブラウザー（Chrome、Firefox、Safari）でテストします。
- **アクセス権限**：ユーザーが必要なAEM権限を持っていることを確認します。

**インターフェイスの問題**

- **パネルの表示**：切り替えボタンを使用して、フォームオブジェクトパネルを表示または非表示にします。
- **ルールの保存**：エディターを閉じる前に、ルールが保存されていることを確認します。
- **ブラウザーズーム**：最適なインターフェイス表示を得るために、ブラウザーのズームを 100% にリセットします。

## 重要な制限事項

>[!IMPORTANT]
>
> **カスタム関数の制限**:
>
> - 静的インポートと動的インポートは、カスタム関数スクリプトではサポートされていません。
> - すべてのコードは、`/blocks/form/functions.js` ファイルに直接含める必要があります。
> - 関数は同期している必要があります（非同期/待機または Promises を使用しない）。
> - セキュリティ上の理由から、ブラウザー API へのアクセスは制限されています。

>[!WARNING]
>
> **実稼動に関する考慮事項**:
>
> - ステージング環境で、すべてのルールを十分にテストします。
> - 複雑なルールをデプロイした後のフォームパフォーマンスの監視。
> - ルールに関する問題のロールバック計画を作成します。
> - ネットワーク接続が遅いユーザーへの影響を考慮します。

## 概要

ユニバーサルエディターのルールエディターを使用すると、卓越したユーザーエクスペリエンスを提供するインテリジェントで動的なフォームを作成できます。 条件付きロジック、自動計算およびカスタム・ビジネス・ルールを実装すると、次のことができます。

**静的Formsを変換**:

- よりクリーンで焦点を絞ったインターフェイス用の条件付きフィールド表示を追加しました。
- リアルタイム計算とデータ検証を実装します。
- コーディングなしで高度なビジネスロジックを作成します。

**ユーザーエクスペリエンスの向上**:

- 論理的なフォームフローのガイドをユーザーに提供する。
- インテリジェントな検証により、エラーを削減します。
- すぐにフィードバックと支援を提供します。

**効率性の向上**:

- 繰り返し計算とデータ入力を自動化します。
- スマートルーティングを使用して複雑なワークフローを効率化します。
- セルフサービス機能により、サポートの負担を軽減

### **次の手順**

これで、ルールエディターの基本事項を理解できました。

1. **単純な開始**：複雑な計算に進む前に、基本的な表示/非表示のルールから始めます。
1. **例を使用したプラクティス**：税金計算のチュートリアルを基礎として使用します。
1. **高度な機能を探索**：特別な要件に合わせたカスタム関数を試します。
1. **徹底的にテスト**：様々なシナリオやデバイスでルールを常に検証します。
1. **パフォーマンスの監視**：ユーザーエクスペリエンスを妨げるのではなく、確実にルールを強化します。
