---
title: GraphQL API を使用したコンテンツの抽出
description: コンテンツ フラグメントと GraphQL API をヘッドレスコンテンツ管理システムとして使用する方法について説明します。
hidefromtoc: true
index: false
exl-id: f5e379c8-e63e-41b3-a9fe-1e89d373dc6b
source-git-commit: 2f4e38ba9bb2e0aab4dc126719a922fc983f8711
workflow-type: tm+mt
source-wordcount: '1092'
ht-degree: 71%

---


# GraphQL API を使用したコンテンツの抽出 {#extract-content}

>[!CONTEXTUALHELP]
>id="aemcloud_sites_trial_admin_content_fragments_graphql"
>title="GraphQL API を使用したコンテンツの抽出"
>abstract="このモジュールでは、コンテンツフラグメントと GraphQL API をヘッドレスコンテンツ管理システムとして使用する方法について説明します。"

>[!CONTEXTUALHELP]
>id="aemcloud_sites_trial_admin_content_fragments_graphql_guide"
>title="GraphQL Explorer の起動"
>abstract="GraphQL はクエリベースの API を提供し、1 回の API 呼び出しを使用して、外部クライアントアプリケーションが AEM に必要なコンテンツのみをクエリできるようにします。このモジュールでは、2 つの異なるタイプのクエリを実行する方法について説明します。次に、前のモジュールで作成したコンテンツフラグメントからコンテンツを取得する方法について説明します。<br><br>下をクリックして、新しいタブでこのモジュールを起動します。"

>[!CONTEXTUALHELP]
>id="aemcloud_sites_trial_admin_content_fragments_graphql_guide_footer"
>title="お疲れさまでした。2 つの基本的なタイプのクエリと、独自のコンテンツをクエリする方法について学びました。これで、AEM GraphQL API を使用して、アプリが想定する形式でコンテンツを配信する効率的なクエリの作成方法を理解できました。"
>abstract=""

## サンプルコンテンツのリストのクエリ {#list-query}

新しいタブで、GraphQL Explorer を起動します。ここでは、ヘッドレスコンテンツに対するクエリを作成して検証してから、アプリや web サイトのコンテンツを強化できます。

1. AEM ヘッドレス体験版には、テスト目的でコンテンツを抽出できるコンテンツフラグメントがプリロードされたエンドポイントが付属しています。エディターの右上隅にある「**エンドポイント**」ドロップダウンメニューで **AEM デモアセット**&#x200B;エンドポイントが選択されていることを確認します。

1. プリロードされた **AEM デモアセット** エンドポイントのリストクエリの次のコードスニペットをコピーします。リストクエリは、特定のコンテンツフラグメントモデルを使用するすべてのコンテンツのリストを返します。在庫ページとカテゴリページでは、通常、このクエリ形式を使用します。

   ```text
   {
    adventureList {
     items {
       _path
       title
       price
       tripLength
       primaryImage {
         ... on ImageRef {
           _path
           mimeType
           width
           height
         }
       }
     }
    }
   }
   ```

1. クエリエディターで既存のコンテンツを置き換えるには、コピーしたコードを貼り付けます。

1. 貼り付けたら、クエリエディターの左上にある「**再生**」ボタンをクリックしてクエリを実行します。

1. 結果は、右側のパネルの、クエリエディターの横に表示されます。クエリが正しくない場合は、右側のパネルにエラーが表示されます。

   ![リストクエリ](assets/do-not-localize/list-query-1-3-4-5.png)

すべてのコンテンツフラグメントの完全なリストのリストクエリを検証しました。 このプロセスは、アプリが期待する応答を確保するのに役立ち、AEM で作成されたコンテンツをアプリや web サイトがどのように取得するのかを示す結果が得られます。

>[!NOTE]
>
>選択できない場合、 **AEMデモアセット** エンドポイントをドロップダウンから選択する場合は、Adobeカスタマーケアに問い合わせるか、 [AEM試用Slackチャネル。](https://adobe-dx-support.slack.com/)

## サンプルコンテンツの特定の部分に対するクエリ {#bypath-query}

byPath クエリを実行すると、特定のコンテンツフラグメントのコンテンツを取得できます。製品詳細ページと特定のコンテンツセットに焦点を当てたページには、通常、このタイプのクエリが必要です。

1. プリロードされた **AEM デモアセット**&#x200B;エンドポイントの byPath クエリの次のコードスニペットをコピーします。

   ```text
    {
     adventureByPath(
       _path: "/content/dam/aem-demo-assets/en/adventures/bali-surf-camp/bali-surf-camp"
     ) {
       item {
         _path
         title
         description {
           json
         }
         primaryImage {
           ... on ImageRef {
             _path
             width
             height
           }
         }
       }
     }
   }
   ```

1. クエリエディターで既存のコンテンツを置き換えるには、コピーしたコードを貼り付けます。

1. 貼り付けたら、クエリエディターの左上にある「**再生**」ボタンをクリックしてクエリを実行します。

1. 結果は、右側のパネルの、クエリエディターの横に表示されます。クエリが正しくない場合は、右側のパネルにエラーが表示されます。

   ![byPath クエリの結果](assets/do-not-localize/bypath-query-2-3-4.png)

byPath クエリを検証し、そのフラグメントのパスで識別される特定のコンテンツフラグメントを取得しました。

## 独自のコンテンツのクエリ {#own-queries}

2 つの主なタイプのクエリを実行したので、独自のコンテンツをクエリする準備が整いました。

1. 独自のコンテンツフラグメントに対してクエリを実行するには、エンドポイントを **AEM デモアセット**&#x200B;フォルダーから自分の&#x200B;**プロジェクト**&#x200B;フォルダーに変更します。

1. クエリエディターで既存のコンテンツをすべて削除します。次に、左括弧 `{` を入力し、Ctrl + スペースキーまたは Option + スペースキーを押して、エンドポイントで定義されたモデルのオートコンプリートリストを表示します。オプションから、先ほど作成した `List` で終わるモデルを選択します。

   ![カスタムクエリを開始](assets/do-not-localize/custom-query-1-2.png)

1. 選択したコンテンツフラグメントモデルに対して、クエリに含める項目を定義します。再び左括弧 `{` を入力し、Ctrl + スペースキーまたは Option + スペースキーを押してオートコンプリートリストを表示します。オプションから `items` を選択します。

1. 「**修飾**」ボタンをタップまたはクリックして、コードを読みやすいように自動的に書式設定します。

1. 完了したら、エディターの左上にある「**再生**」ボタンをタップまたはクリックして、クエリを実行します。エディターが `items` をオートコンプリートし、クエリが実行されます。

1. 右側のパネルのクエリエディターの横に、結果が表示されます。

   ![カスタムクエリの実行](assets/do-not-localize/custom-query-3-4-5-6.png)

コンテンツをオムニチャネルのデジタルエクスペリエンスに配信する方法は次のとおりです。

## 永続クエリ {#persisted-queries}

永続化されたクエリは、GraphQL API をクライアントアプリケーションに公開するための推奨されるメカニズムです。 クエリが保持されると、GETリクエストを使用してリクエストでき、高速に取得できるようにキャッシュされます。

クライアントアプリケーションから使用するデータを含む、永続化されたクエリを作成します。

1. 作成したデータをコンテンツフラグメントとして使用するので、必ず **プロジェクト** エンドポイントが **エンドポイント** エディターの右上隅にあるドロップダウンメニュー。

1. 次のコードスニペットをコピーします。

   ```text
      {
      adventureList {
       items {
         title
         description {
           plaintext
         }
         title
         price
         image {
           ... on ImageRef {
             _publishUrl
             mimeType
           }
         }
       }
     }
   }
   ```

1. クエリエディターで既存のコンテンツを置き換えるには、コピーしたコードを貼り付けます。

   >[!NOTE]
   >
   >前のモジュールで説明したのと同じフィールドの説明を使用しなかった場合は、このクエリでフィールド名を更新する必要があります。
   >
   >前述のように、GraphQLのオートコンプリート（Ctrl +スペースキーまたは Option +スペースキー）機能を使用して、使用可能なプロパティを特定します。

1. 貼り付けたら、クエリエディターの左上にある「**再生**」ボタンをクリックしてクエリを実行します。

1. 結果は、右側のパネルの、クエリエディターの横に表示されます。クエリが正しくない場合は、右側のパネルにエラーが表示されます。

   ![独自クエリを作成](assets/do-not-localize/own-query.png)

1. クエリが完了したら、 **名前を付けて保存** ボタンをクリックして、クエリを保持します。

1. 内 **クエリ名** ポップアップで、クエリに名前を付けます。 `adventure-list`.

1. タップまたはクリック **名前を付けて保存**.

   ![クエリを保持](assets/do-not-localize/persist-query.png)

1. クエリは、画面の下部にあるバナーメッセージで確認されたとおりに保持されます。 また、クエリは、ウィンドウ内の永続化されたクエリの左側のパネルにも表示されます。

1. 永続化されたクエリを公開するには、コンテンツフラグメントの公開方法と同様に、公開する必要があります。 次をクリック： **公開** ボタンをクリックして、クエリを公開します。

1. バナー通知で公開が確認されます。

これで、定義した特定のプロパティと形式のみを含む、新しい永続的なクエリが作成されました。
