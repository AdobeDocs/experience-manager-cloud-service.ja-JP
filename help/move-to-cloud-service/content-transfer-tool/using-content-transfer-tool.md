---
title: コンテンツ転送ツールの使用
description: コンテンツ転送ツールの使用
translation-type: tm+mt
source-git-commit: f3a4fdf57dc84bba9811530fccb2fe6a4404376f
workflow-type: tm+mt
source-wordcount: '1902'
ht-degree: 89%

---


# コンテンツ転送ツールの使用 {#using-content-transfer-tool}

## コンテンツ転送ツール使用時の重要な考慮事項 {#pre-reqs}

コンテンツ転送ツールを実行する際には、次の重要事項を考慮してください。

* コンテンツ転送ツールに必要なシステム構成は、AEM 6.3 以降と Java 8 です。使用している AEM のバージョンがこれより古い場合、コンテンツ転送ツールを使用するには、コンテンツリポジトリを AEM 6.5 にアップグレードする必要があります。

* AEM を開始するユーザーが `java` コマンドを実行できるように、AEM 環境上で Java を設定する必要があります。

* コンテンツ転送ツールは、ファイルデータストア、S3 データストア、共有 S3 データストア、Azure Blob Store データストアと共に使用できます。

* *サンドボックス環境*&#x200B;を使用している場合は、環境が最新で最新のリリースにアップグレードされていることを確認してください。*実稼動環境*&#x200B;を使用している場合、環境は自動的に更新されます。

* コンテンツ転送ツールを使用するユーザーは、ソースインスタンスの管理者で、コンテンツの転送先の Cloud Service インスタンスの AEM 管理者グループに属している必要があります。権限のないユーザーは、コンテンツ転送ツールを使用するアクセストークンを取得できません。

* 現在、AEM as a Cloud Service オーサーインスタンスのデフォルト MongoDB サイズは 32GB です。セグメントストアのサイズが 20GB を超える場合は、サポートチケットを送信して MongoDB のサイズを増やすことをお勧めします。

* コンテンツ転送ツールによって転送されるユーザーとグループは、権限を満たすためにコンテンツで必要なもののみです。 *抽出*&#x200B;プロセスは、`/home`全体を移行セットにコピーし、*インジェスト*&#x200B;プロセスは、移行されたコンテンツACLで参照されているすべてのユーザーとグループをコピーします。

* 抽出段階では、コンテンツ転送ツールはアクティブな AEM ソースインスタンスで実行されます。

* コンテンツ転送処理の&#x200B;*抽出*&#x200B;段階が完了し、*取り込み段階*&#x200B;を開始して、Cloud Service *段階*&#x200B;または&#x200B;*実稼働環境*&#x200B;のインスタンスとしてAEMにコンテンツを取り込む前に、サポートチケットをログに記録する必要があります。インジェスト&#x200B;*を使用すると、*&#x200B;インジェスト&#x200B;*プロセス中にAdobeが中断を起こさないようにできます。*&#x200B;計画された&#x200B;*取り込み*&#x200B;日の1週間前に、サポートチケットをログに記録する必要があります。 サポートチケットを送信すると、サポートチームは次の手順に関するガイダンスを提供します。
   * 次の詳細を含むサポートチケットをログに記録します。
      * *インジェスト*&#x200B;段階の開始を計画している場合は、（タイムゾーンに合わせて）日付と予測時刻を正確に指定してください。
      * データを取り込む環境タイプ（ステージまたは実稼働）。
      * プログラムID。

* オーサーの&#x200B;*インジェスト段階*&#x200B;では、オーサーのデプロイメント全体がスケールダウンされます。つまり、オーサー AEM インスタンスは、インジェストプロセス全体で使用できなくなります。また、*取り込み*&#x200B;フェーズの実行中に、Cloud Managerのパイプラインが実行されないようにしてください。


## 入手方法 {#availability}

コンテンツ転送ツールは、ソフトウェア配布ポータルから zip ファイルとしてダウンロードできます。パッケージマネージャーを使用して、このパッケージをソース AEM（Adobe Experience Manager）インスタンスにインストールできます。最新バージョンをダウンロードしてください。  最新バージョンの詳細については、「[リリースノート](https://docs.adobe.com/content/help/ja-JP/experience-manager-cloud-service/release-notes/release-notes/release-notes-current.translate.html)」を参照してください。

>[!NOTE]
>[ソフトウェア配布ポータル](https://experience.adobe.com/#/downloads/content/software-distribution/jp/aemcloud.html)からコンテンツ転送ツールをダウンロードします。

## コンテンツ転送ツールの実行 {#running-tool}

>[!VIDEO](https://video.tv.adobe.com/v/35460/?quality=12&learn=on)


この節では、コンテンツ転送ツールを使用してコンテンツを AEM as a Cloud Service（オーサー／パブリッシュ）に移行する方法について説明します。

1. Adobe Experience Manager を選択し、ツール／**運営**／**コンテンツ転送**&#x200B;に移動します。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/content1.png)

1. 最初の移行セットを作成すると、次のコンソールが表示されます。「**移行セットを作成**」をクリックして、新しい移行セットを作成します。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/01-migration-set-overview.png)

   >[!NOTE]
   >既存の移行セットがある場合、コンソールには既存の移行セットのリストが表示され、現在のステータスが表示されます

1. **コンテンツ移行セットの詳細**&#x200B;画面のフィールドに、以下のように値を入力します。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/02-migration-set-creation.png)


   1. **名前**：移行セットの名前を入力します。
      >[!NOTE]
      >移行セット名には特殊文字を使用できません。

   1. **クラウドサービス設定**：移行先の AEM as a Cloud Service オーサーの URL を入力します。

      >[!NOTE]
      >コンテンツ転送をおこなう際は、一度に最大 4 つの移行セットを作成し維持管理できます。
      >さらに、特定の環境（*ステージング*、*開発*、*実稼動*&#x200B;のいずれか）ごとに個別に移行セットを作成する必要があります。

   1. **アクセストークン**：アクセストークンを入力します。

      >[!NOTE]
      >「**アクセストークンを開く**」ボタンを使用してアクセストークンを取得できます。ターゲット Cloud Service インスタンスの AEM 管理者グループに属していることを確認する必要があります。

   1. **パラメーター**：移行セットを作成するには、次のパラメータを選択します。

      1. **バージョンを含める**：必要に応じて選択します。

      1. **含めるパス**：パスブラウザーを使用して、移行する必要があるパスを選択します。パスピッカーは、キーボード入力または選択による入力を受け付けます。

         >[!IMPORTANT]
         >移行セットの作成時には、次のパスは制限されます。
         >* `/apps`
         >* `/libs`
         >* `/home`
         >* `/etc`


1. **コンテンツ移行セットの詳細**&#x200B;画面のすべてのフィールドに値を入力したら、「**保存**」をクリックします。

1. 移行セットが&#x200B;*概要*&#x200B;ページに表示されます。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/04-item-selection-and-quick-actions.png)

   既存のすべての移行セットが、現在のステータスなどのステータス情報と共に&#x200B;*概要*&#x200B;ページに表示されます。以下に示すアイコンの一部が表示されます。

   * *赤い雲*&#x200B;は、抽出プロセスを完了できないことを示しています。
   * *緑の雲*&#x200B;は、抽出プロセスを完了できることを示しています。
   * *黄色のアイコン*&#x200B;は、その既存の移行セットが同じインスタンス内の他のユーザーによって作成されたことを示しています。

1. 概要ページで移行セットを選択し、「**プロパティ**」をクリックして、移行セットのプロパティを表示または編集します。プロパティの編集中は、コンテナ名またはサービス URL を変更できません。



### コンテンツ転送の抽出プロセス {#extraction-process}

コンテンツ転送ツールで移行セットを抽出するには、次の手順に従います。

1. *概要*&#x200B;ページで移行セットを選択し、「**抽出**」をクリックして抽出を開始します。**移行セットの抽出**&#x200B;ダイアログボックスが表示されるので、「**抽出**」をクリックして抽出段階を完了します。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/06-content-extraction.png)

   >[!NOTE]
   >抽出段階では、ステージングコンテナを上書きするオプションがあります。


1. 「**抽出**」フィールドに「**実行中**」ステータスが表示され、抽出が進行中であることを示します。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/07-extraction-job-running.png)

   抽出が完了すると、移行セットのステータスが&#x200B;**完了**&#x200B;に更新され、*緑で塗りつぶされた*&#x200B;雲のアイコンが「**情報**」フィールドに表示されます。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/10-extraction-complete.png)

   >[!NOTE]
   >UI には自動リロード機能があり、30 秒ごとに概要ページをリロードします。
   >抽出フェーズが開始されると、書き込みロックが作成され、*60 秒*&#x200B;後に解放されます。したがって、抽出が停止した場合は、ロックが解除されるまで 1 分待ってから、抽出を再開する必要があります。

#### 追加抽出 {#top-up-extraction-process}

コンテンツ転送ツールには、差分コンテンツ追加をサポートする機能があります。差分追加では、前回のコンテンツ転送アクティビティ以降に加えられた変更のみを転送できます。

>[!NOTE]
>最初のコンテンツ転送の後は、差分コンテンツ追加を頻繁におこなって、Cloud Service での運用を開始する前におこなう最後の差分コンテンツ転送に必要なコンテンツ凍結期間を短縮することをお勧めします。

抽出プロセスが完了したら、追加抽出方式を使用して差分コンテンツを転送できます。それには、次の手順に従います。

1. *概要*&#x200B;ページに移動し、追加抽出の実行対象となる移行セットを選択します。「**抽出**」をクリックして、追加抽出を開始します。**移行セットの抽出**&#x200B;ダイアログボックスが表示されます。

   >[!IMPORTANT]
   >
   >「**抽出時にステージングコンテナを上書き**」オプションを無効にしてください。
   >
   >![画像](/help/move-to-cloud-service/content-transfer-tool/assets/11-topup-extraction.png)

### コンテンツ転送のインジェストプロセス {#ingestion-process}

コンテンツ転送ツールで移行セットを取り込むには、次の手順に従います。

1. *概要*&#x200B;ページで移行セットを選択し、「**取得**」をクリックして取得を開始します。**移行セットの取得**&#x200B;ダイアログボックスが表示されます。「**取得**」をクリックして、取得段階を完了します。デモのために、「**コンテンツをオーサーインスタンスに取り込み**」オプションは無効になっています。コンテンツをオーサーとパブリッシュに同時に取り込むことができます。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/12-content-ingestion.png)

1. 取得が完了すると、「**取得を公開**」フィールドのステータスが「**完了**」に更新されます。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/15-ingestion-complete.png)

#### 追加インジェスト {#top-up-ingestion-process}

コンテンツ転送ツールには、*差分コンテンツ追加*&#x200B;をサポートする機能があります。差分追加では、前回のコンテンツ転送アクティビティ以降に加えられた変更のみを転送できます。

>[!NOTE]
>
>最初のコンテンツ転送の後は、差分コンテンツ追加を頻繁におこなって、Cloud Service での運用を開始する前におこなう最後の差分コンテンツ転送に必要なコンテンツ凍結期間を短縮することをお勧めします。

インジェストプロセスが完了したら、追加インジェスト方式を使用して差分コンテンツを転送できます。それには、次の手順に従います。

1. *概要*&#x200B;ページに移動し、追加取得の実行対象となる移行セットを選択します。「**取得**」をクリックして、追加取得を開始します。**移行セットの取得**&#x200B;ダイアログボックスが表示されます。

   >[!IMPORTANT]
   >
   >以前の取得アクティビティから既存のコンテンツを削除しないようにするには、「**取得前にクラウドインスタンス上の既存のコンテンツを消去**」オプションを無効にする必要があります。
   >
   >![画像](/help/move-to-cloud-service/content-transfer-tool/assets/16-topup-ingestion.png)

### 移行セットのログの表示 {#viewing-logs-migration-set}

既存の移行セットのログを&#x200B;*概要*&#x200B;ページから表示できます。それには、次の手順に従います。

1. *概要*&#x200B;ページに移動し、ログを表示する移行セットを選択し、アクションバーの「**ログを表示**」をクリックします。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/view-log1.png)

1. **ログ**&#x200B;ダイアログボックスが表示されます。「**抽出ログ**」をクリックすると、ログが新しいタブに表示されます。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/view-log2.png)
または、

   *概要*&#x200B;画面から移行セットのログを直接表示することもできます。移行セットを選択し、「**抽出**」フィールド内のステータスをクリックします。下図の場合は、「**完了**」をクリックすると、ログが新しいタブに表示されます。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/view-log3.png)

1. ユーザーインターフェイスを使用せずにログの末尾を表示するには、ソース AEM 環境に SSH で接続し、`crx-quickstart/cloud-migration/extraction-XXXXX/output.log file`で tail コマンドを実行します。

### 移行セットの削除 {#deleting-migration-set}

*概要*ページで移行セットを削除できます。
それには、次の手順に従います。

1. *概要*&#x200B;ページに移動し、削除する移行セットを選択し、アクションバーの「**削除**」をクリックします。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/delete-1.png)

1. **移行セットを削除**&#x200B;ダイアログボックスの「**削除**」をクリックして、削除を確定します。

   ![画像](/help/move-to-cloud-service/content-transfer-tool/assets/delete-3.png)

## トラブルシューティング {#troubleshooting}

### 不明な BLOB ID {#missing-blobs}

以下に示すように、不明な BLOB ID が報告された場合は、既存のリポジトリで整合性チェックを実行し、不明な BLOB を復元する必要があります。
`ERROR o.a.j.o.p.b.AbstractSharedCachingDataStore - Error retrieving record [ba45c53f8b687e7056c85dceebf8156a0e6abc7e]`

以下のコマンドを実行します。

>[!NOTE]
>
>`--verbose` フラグが必要なのは、BLOB の参照元ノードのパスを報告するためです。

**AEM 6.5（Oak 1.8 以前）のリポジトリの場合**

```shell
java -jar oak-run.jar datastorecheck --consistency --store [<SEGMENT_STORE_PATH>|<MONGO_URI>] --[s3ds|fds] <DATASTORE_CFG> --verbose <OUT_DIR> --dump
```

**Oak 1.10 以降のリポジトリの場合**

```shell
java -jar oak-run.jar datastore --check-consistency [<SEGMENT_STORE_PATH>|<MONGO_URI>] --[s3ds|fds|azureds] <DATASTORE_CFG> --out-dir <OUT_DIR> --work-dir <TEMP_DIR> --verbose
```

詳しくは、[Oak Runnable Jar](https://github.com/apache/jackrabbit-oak/tree/trunk/oak-run)（Oak 実行可能 Jar）を参照してください。

整合性チェックのために上記で指定された *OUT_DIR* に作成されたファイルを調べて、不明なバイナリのパスや必要なアクション（バックアップからの復元、パスの削除、インデックスの再作成など）を確認できます。

### UI の動作 {#ui-behavior}

コンテンツ転送ツールのユーザーインターフェイス（UI）に次のような動作が見られることがあります。

* ユーザーが、オーサー URL（開発／ステージング／実稼動）の移行セットを作成し、抽出とインジェストを正常に実行します。

* 次に、同じオーサー URL の新しい移行セットを作成し、その新しい移行セットに対して抽出とインジェストを実行します。UI の表示では、最初の移行セットのインジェスト状態が&#x200B;**失敗**&#x200B;に変わり、使用可能なログがないことになります。

* それでも、最初の移行セットのインジェストが失敗したわけではありません。この動作が見られるのは、新しいインジェストジョブが開始されると、前回のインジェストジョブが削除されるからです。したがって、最初の移行セットのステータス変更は無視してください。

* コンテンツ転送ツール UI のアイコンが、このガイドに示すスクリーンショットとは異なって表示される場合や、ソース AEM インスタンスのバージョンによっては表示されない場合があります。


