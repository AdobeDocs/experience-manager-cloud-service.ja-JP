---
title: ロールアウトの競合
description: Multi Site Managerのロールアウトの競合を管理および解決する方法について説明します。
feature: マルチサイトマネージャー
role: Administrator
exl-id: 733e9411-50a7-42a5-a5a8-4629f6153f10
source-git-commit: 90de3cf9bf1c949667f4de109d0b517c6be22184
workflow-type: tm+mt
source-wordcount: '926'
ht-degree: 25%

---

# ロールアウトの競合 {#msm-rollout-conflicts}

ブループリントブランチと依存するライブコピーブランチの両方に同じページ名の新しいページが作成されると、競合が発生する可能性があります。 このような競合はロールアウト時に処理および解決する必要があります。

## 競合の処理  {#conflict-handling}

競合するページが（ブループリントとライブコピーのブランチに）存在する場合、MSMではそれらの処理方法（または処理する場合も）を定義できます。

ロールアウトがブロックされないように、次の内容を定義します。

* ロールアウト時に優先されるページ（ブループリントまたはライブコピー）
* 名前を変更するページ（および方法）
* この変更が公開されたコンテンツに及ぼす影響

デフォルトのAEMのデフォルトの動作は、公開されたコンテンツに影響を与えないことです。 したがって、ライブコピーブランチで手動で作成されたページが公開されても、競合の処理とロールアウトの後もそのコンテンツは公開され続けます。

標準の機能に加えて、カスタマイズされた競合ハンドラーを追加して別のルールを実装できます。これらは、アクションを個別のプロセスとして公開することも許可します。

### サンプルシナリオ {#example-scenario}

以降の節では、（手動で作成した）ブループリントとライブコピーのブランチの両方に作成された新しいページ`b`の例を使用して、競合を解決する様々な方法を説明します。

* ブループリント：`/b`

   子ページ`bp-level-1`が1つあるマスターページ

* ライブコピー: `/b`

   子ページ`lc-level-1`が1つあるライブコピーブランチに手動で作成されたページ

   * 公開時に子ページと共に`/b`としてアクティブ化

#### ロールアウト前 {#before-rollout}

|  | ロールアウト前のブループリント | ロールアウト前のライブコピー | ロールアウト前に公開 |
|---|---|---|---|
| 値 | `b` | `b` | `b` |
| コメント | ブループリントブランチに作成され、ロールアウトの準備ができました | ライブコピーのブランチで手動で作成 | ライブコピーのブランチで手動で作成されたページ`b`のコンテンツを含みます |
| 値 | `/bp-level-1` | `/lc-level-1` | `/lc-level-1` |
| コメント |  | ライブコピーのブランチで手動で作成 | ライブコピーのブランチで手動で作成されたページ`child-level-1`の内容が含まれます。 |

## Rollout Manager and Conflict Handling {#rollout-manager-and-conflict-handling}

ロールアウトマネージャーを使用すると、競合の管理をアクティベートまたはアクティベートを解除できます。

これは、**Day CQ WCM Rollout Manager**&#x200B;の[OSGi設定](/help/implementing/deploying/configuring-osgi.md)を使用しておこないます。 ブループリント内に存在する名前でライブコピー内に作成されたページの競合をロールアウトマネージャーが処理する必要がある場合は、値&#x200B;**手動で作成されたページとの競合を処理** ( `rolloutmgr.conflicthandling.enabled` )をtrueに設定します。

競合管理が非アクティブ化された場合のAEMの動作は[事前定義済みです。](#behavior-when-conflict-handling-deactivated)

## 競合ハンドラー {#conflict-handlers}

AEMは、競合ハンドラーを使用して、ブループリントからライブコピーにコンテンツをロールアウトする際に存在するページの競合を解決します。 ページ名の変更は、（だけでなく）通常の方法で競合を解決します。 別の動作を選択できるように、複数の競合ハンドラーを有効にすることもできます。

AEM には次の機能があります。

* [デフォルトの競合ハンドラー](#default-conflict-handler)：
   * `ResourceNameRolloutConflictHandler`
* [カスタマイズされたハンドラー](#customized-handlers)を実装する可能性
* 個々のハンドラーの優先度を設定できるサービスランキングメカニズム
   * 最もランキングの高いサービスが使用されます。

### デフォルトの競合ハンドラー {#default-conflict-handler}

デフォルトの競合ハンドラーは`ResourceNameRolloutConflictHandler`です

* このハンドラーを使用すると、ブループリントページが優先されます。
* このハンドラーのサービスランキングは、`service.ranking`プロパティのデフォルト値を下回るように低く設定されています。カスタマイズされたハンドラーは、より高いランクを必要とすると仮定しています。 ただし、必要に応じて柔軟に対応するために、ランキングを絶対最小値にはしません。

この競合ハンドラーでは、ブループリントが優先されます。例えば、ライブコピーページ`/b`は、ライブコピーブランチ内で`/b_msm_moved`に移動されます。

* ライブコピー: `/b`

   ライブコピー内で`/b_msm_moved`に移動されます。 これはバックアップとして機能し、コンテンツが失われないようにします。

   * `lc-level-1` は移動されません。

* ブループリント: `/b`

   ライブコピーページ`/b`にロールアウトされます。

   * `bp-level-1` がライブコピーにロールアウトされます。

#### ロールアウト後 {#after-rollout}

|  | ロールアウト後のブループリント | ロールアウト後のライブコピー | ロールアウト後のライブコピー | ロールアウト後に公開 |
|---|---|---|---|---|
| 値 | `b` | `b` | `b_msm_moved` | `b` |
| コメント |  | ロールアウトされたブループリントページ`b`のコンテンツがある | ライブコピーのブランチで手動で作成されたページ`b`のコンテンツがある | 変更はありません。ライブコピーのブランチで手動で作成され、現在は`b_msm_moved`と呼ばれている元のページ`b`の内容が含まれます。 |
| 値 | `/bp-level-1` | `/bp-level-1` | `/lc-level-1` | `/lc-level-1` |
| コメント |  |  | 変更なし | 変更なし |

### カスタマイズされたハンドラー {#customized-handlers}

カスタマイズされた競合ハンドラーを使用すると、独自のルールを実装できます。サービスランキングメカニズムを使用することで、他のハンドラーとの関わり方を定義することもできます。

カスタマイズされた競合ハンドラーでは、次の操作をおこなうことができます。

* 要件に合わせて名前を付けることができます。
* 要件に従って開発/設定します。
   * 例えば、ライブコピーページが優先されるようにハンドラーを開発できます。
* [OSGi設定](/help/implementing/deploying/configuring-osgi.md)を使用して設定できます。特に、
   * **サービ** スランキングでは、他の競合ハンドラー( )に関連する順序を定 `service.ranking`義します。
      * デフォルト値は `0` です。

### 競合処理の非アクティブ化時の動作{#behavior-when-conflict-handling-deactivated}

手動で[競合処理を非アクティブ化した場合、](#rollout-manager-and-conflict-handling) AEMは競合するページに対して何のアクションも実行しません。 競合しないページは、期待どおりにロールアウトされます。

>[!CAUTION]
>
>競合の処理が無効になっている場合、AEMは競合が無視されていることを示しません。 このような場合、この動作は明示的に設定する必要があるので、これが目的の動作であると見なされます。

この場合、ライブコピーが効果的に優先されます。 ブループリントページ`/b`はコピーされず、ライブコピーページ`/b`は変更されません。

* ブループリント: `/b`

   全くコピーされませんが、無視されます。

* ライブコピー: `/b`

   同じです。

#### ロールアウト後 {#after-rollout-no-conflict}

|  | ロールアウト後のブループリント | ロールアウト後のライブコピー | ロールアウト後に公開 |
|---|---|---|---|
| 値 | `b` | `b` | `b` |
| コメント |  | 変更はありません。ライブコピーのブランチで手動で作成されたページ`b`のコンテンツが含まれます。 | 変更なし。ライブコピーのブランチで手動で作成されたページ`b`のコンテンツが含まれます。 |
| 値 | `/bp-level-1` | `/lc-level-1` | `/lc-level-1` |
| コメント |  | 変更なし | 変更なし |

### サービスランキング {#service-rankings}

[OSGi](https://www.osgi.org/) サービスランキングは各競合ハンドラーの優先度を定義するために使用できます。
