---
title: ロールアウトの競合
description: マルチサイトマネージャの展開の競合を管理および解決する方法について説明します。
translation-type: tm+mt
source-git-commit: 4fc4dbe2386d571fa39fd6d10e432bb2fc060da1
workflow-type: tm+mt
source-wordcount: '923'
ht-degree: 25%

---


# ロールアウトの競合 {#msm-rollout-conflicts}

同じページ名を持つ新しいページがBlueprintブランチと依存するLive Copyブランチの両方で作成された場合、競合が発生する可能性があります。 このような競合はロールアウト時に処理および解決する必要があります。

## 競合の処理  {#conflict-handling}

競合するページが存在する場合（BluePrintおよびLive Copyの分岐内）、MSMでは、それらの処理方法（または場合によっても）を定義できます。

ロールアウトがブロックされないように、次の内容を定義します。

* 展開時に優先するページ（BluePrintまたはLive Copy）
* 名前を変更するページ（および方法）
* これが公開されたコンテンツに与える影響

AEMのデフォルトの動作では、すぐに使用できますが、公開されたコンテンツは影響を受けません。 したがって、ライブコピーブランチに手動で作成されたページが公開された場合、そのコンテンツは、競合の処理と展開の後も公開されます。

標準の機能に加えて、カスタマイズされた競合ハンドラーを追加して別のルールを実装できます。これらは、アクションを個別のプロセスとして公開することも許可します。

### サンプルシナリオ {#example-scenario}

以下のセクションでは、ブループリントとライブコピーブランチ（手動で作成）の両方で作成された新しいページ`b`の例を使用して、競合解決の様々な方法を説明します。

* blueprint:`/b`

   1つの子ページを持つマスターページ`bp-level-1`

* ライブコピー: `/b`

   1つの子ページ`lc-level-1`を持つライブコピーブランチに手動で作成されたページ

   * 子ページと共に`/b`として公開時にアクティブ化

#### ロールアウト前 {#before-rollout}

|  | ロールアウト前のBlueprint | ロールアウト前のライブコピー | ロールアウト前に公開 |
|---|---|---|---|
| 値 | `b` | `b` | `b` |
| コメント | BluePrintブランチで作成、展開に対応 | ライブコピーブランチで手動で作成 | ライブコピーブランチに手動で作成されたページ`b`のコンテンツが含まれます |
| 値 | `/bp-level-1` | `/lc-level-1` | `/lc-level-1` |
| コメント |  | ライブコピーブランチで手動で作成 | ライブコピーブランチに手動で作成されたページ`child-level-1`の内容が含まれます |

## Rollout Manager and Conflict Handling {#rollout-manager-and-conflict-handling}

ロールアウトマネージャーを使用すると、競合の管理をアクティベートまたはアクティベートを解除できます。

これは、**Day CQ WCM Rollout Manager**&#x200B;の[OSGi設定](/help/implementing/deploying/configuring-osgi.md)を使用して行います。 値&#x200B;**手動で作成したページ** ( `rolloutmgr.conflicthandling.enabled` )との競合を処理する場合、ロールアウトマネージャは、ライブコピーで作成されたページの競合を、青写真に存在する名前で処理する必要がある場合は、値Handle conflictをtrueに設定します。

競合管理が非アクティブ化されている場合、AEMには[定義済みの動作があります。](#behavior-when-conflict-handling-deactivated)

## 競合ハンドラー {#conflict-handlers}

AEMでは、ブループリントからライブコピーにコンテンツをロールアウトする際に存在するページの競合を解決するために、競合ハンドラーを使用します。 ページ名の変更は、このような競合を解決する通常の方法です（ただし、その他の方法も使用します）。 別の動作を選択できるように、複数の競合ハンドラーを有効にすることもできます。

AEM には次の機能があります。

* [デフォルトの競合ハンドラー](#default-conflict-handler)：
   * `ResourceNameRolloutConflictHandler`
* [カスタマイズされたハンドラ](#customized-handlers)を実装する可能性
* 個々のハンドラーの優先度を設定できるサービスのランキングメカニズム
   * 最もランキングの高いサービスが使用されます。

### デフォルトの競合ハンドラー {#default-conflict-handler}

デフォルトの競合ハンドラは`ResourceNameRolloutConflictHandler`です

* このハンドラーを使用すると、ブループリントページが優先されます。
* このハンドラーのサービスのランクは低く設定されます。つまり、`service.ranking`プロパティのデフォルト値の下に設定されます。カスタマイズされたハンドラーはより高いランクが必要となると想定しています。 ただし、必要に応じて柔軟に対応するために、ランキングを絶対最小値にはしません。

この競合ハンドラーでは、ブループリントが優先されます。例えば、ライブコピーページ`/b`は、ライブコピーブランチ内で`/b_msm_moved`に移動されます。

* ライブコピー: `/b`

   ライブコピー内の`/b_msm_moved`に移動されます。 これはバックアップとして機能し、コンテンツが失われないようにします。

   * `lc-level-1` は移動されません。

* ブループリント: `/b`

   ライブコピーページ`/b`にロールアウトされます。

   * `bp-level-1` がライブコピーにロールアウトされたとき。

#### ロールアウト後 {#after-rollout}

|  | 展開後のBlueprint | ロールアウト後のライブコピー | ロールアウト後のライブコピー | ロールアウト後にパブリッシュ |
|---|---|---|---|---|
| 値 | `b` | `b` | `b_msm_moved` | `b` |
| コメント |  | 展開されたBluePrintページ`b`の内容がある | ライブコピーブランチに手動で作成されたページ`b`のコンテンツがある | 変更はありません。ライブコピーブランチで手動で作成された、`b`という名前の元のページの内容が含まれます。`b_msm_moved` |
| 値 | `/bp-level-1` | `/bp-level-1` | `/lc-level-1` | `/lc-level-1` |
| コメント |  |  | 変更なし | 変更なし |

### カスタマイズされたハンドラー {#customized-handlers}

カスタマイズされた競合ハンドラーを使用すると、独自のルールを実装できます。サービスランキングメカニズムを使用することで、他のハンドラーとの関わり方を定義することもできます。

カスタマイズされた競合ハンドラーでは、次の操作をおこなうことができます。

* 要件に合わせて名前を付けることができます。
* 必要に応じて開発/構成を行う。
   * 例えば、ライブコピーページを優先するハンドラーを作成できます。
* [OSGi設定](/help/implementing/deploying/configuring-osgi.md)を使用して設定できます。特に、
   * **サービス** のランキングでは、他の競合ハンドラ(  `service.ranking`)に関連する順序を定義します。
      * デフォルト値は `0` です。

### 競合処理が非アクティブな場合の動作{#behavior-when-conflict-handling-deactivated}

競合処理を手動で[非アクティブ化すると、競合するページに対して](#rollout-manager-and-conflict-handling) AEMは何も実行しません。 競合しないページは、期待どおりにロールアウトされます。

>[!CAUTION]
>
>競合処理が無効になっている場合、AEMは競合が無視されることを示す表示を一切しません。 このような場合、この動作は明示的に設定する必要があるので、これが目的の動作であると想定します。

この場合、ライブコピーが効果的に優先されます。 Blueprintページ`/b`はコピーされず、ライブコピーページ`/b`は変更されません。

* ブループリント: `/b`

   は一切コピーされませんが、無視されます。

* ライブコピー: `/b`

   同じです。

#### ロールアウト後 {#after-rollout-no-conflict}

|  | 展開後のBlueprint | ロールアウト後のライブコピー | ロールアウト後にパブリッシュ |
|---|---|---|---|
| 値 | `b` | `b` | `b` |
| コメント |  | 変更はありません。ライブコピーブランチに手動で作成された`b`ページのコンテンツがあります | 変更なし。ライブコピーブランチに手動で作成されたページ`b`の内容が含まれます。 |
| 値 | `/bp-level-1` | `/lc-level-1` | `/lc-level-1` |
| コメント |  | 変更なし | 変更なし |

### サービスランキング {#service-rankings}

[OSGi](https://www.osgi.org/) サービスランキングは各競合ハンドラーの優先度を定義するために使用できます。
